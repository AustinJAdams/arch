

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>arch.univariate.base &#8212; arch 4.7.0+4.g8a3c5ff documentation</title>
    <link rel="stylesheet" href="../../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  
  
   

  <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">arch 4.7.0+4.g8a3c5ff documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../../index.html" class="text-logo">arch 4.7.0 (+4)</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../univariate/univariate.html">Univariate Volatility Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bootstrap/bootstrap.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../multiple-comparison/multiple-comparisons.html">Multiple Comparison Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unitroot/unitroot.html">Unit Root Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">Change Log</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../../index.html">Docs</a></li>
              
                <li><a href="../../index.html">Module code</a></li>
              
              <li>arch.univariate.base</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <h1>Source code for arch.univariate.base</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Core classes for ARCH models</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">arch.compat.python</span> <span class="k">import</span> <span class="n">add_metaclass</span><span class="p">,</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="k">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">OptimizeResult</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.iolib.summary</span> <span class="k">import</span> <span class="n">Summary</span><span class="p">,</span> <span class="n">fmt_2cols</span><span class="p">,</span> <span class="n">fmt_params</span>
<span class="kn">from</span> <span class="nn">statsmodels.iolib.table</span> <span class="k">import</span> <span class="n">SimpleTable</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.numdiff</span> <span class="k">import</span> <span class="n">approx_fprime</span><span class="p">,</span> <span class="n">approx_hess</span>

<span class="kn">from</span> <span class="nn">arch.univariate.distribution</span> <span class="k">import</span> <span class="n">Distribution</span><span class="p">,</span> <span class="n">Normal</span>
<span class="kn">from</span> <span class="nn">arch.univariate.volatility</span> <span class="k">import</span> <span class="n">ConstantVariance</span><span class="p">,</span> <span class="n">VolatilityProcess</span>
<span class="kn">from</span> <span class="nn">arch.utility.array</span> <span class="k">import</span> <span class="n">AbstractDocStringInheritor</span><span class="p">,</span> <span class="n">ensure1d</span>
<span class="kn">from</span> <span class="nn">arch.utility.exceptions</span> <span class="k">import</span> <span class="p">(</span><span class="n">ConvergenceWarning</span><span class="p">,</span> <span class="n">StartingValueWarning</span><span class="p">,</span>
                                     <span class="n">convergence_warning</span><span class="p">,</span>
                                     <span class="n">starting_value_warning</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">arch.vendor.cached_property</span> <span class="k">import</span> <span class="n">cached_property</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;implicit_constant&#39;</span><span class="p">,</span> <span class="s1">&#39;ARCHModelResult&#39;</span><span class="p">,</span> <span class="s1">&#39;ARCHModel&#39;</span><span class="p">,</span> <span class="s1">&#39;ARCHModelForecast&#39;</span><span class="p">,</span> <span class="s1">&#39;constraint&#39;</span><span class="p">]</span>

<span class="c1"># Callback variables</span>
<span class="n">_callback_iter</span><span class="p">,</span> <span class="n">_callback_llf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="n">_callback_func_count</span><span class="p">,</span> <span class="n">_callback_iter_display</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">_callback</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback for use in optimization</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    parameters : : ndarray</span>
<span class="sd">        Parameter value (not used by function)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Uses global values to track iteration, iteration display frequency,</span>
<span class="sd">    log likelihood and function count</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_callback_iter</span>
    <span class="n">_callback_iter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="s1">&#39;Iteration: </span><span class="si">{0:&gt;6}</span><span class="s1">,   Func. Count: </span><span class="si">{1:&gt;6.3g}</span><span class="s1">,   Neg. LLF: </span><span class="si">{2}</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">_callback_iter</span> <span class="o">%</span> <span class="n">_callback_iter_display</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">disp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_callback_iter</span><span class="p">,</span> <span class="n">_callback_func_count</span><span class="p">,</span> <span class="n">_callback_llf</span><span class="p">))</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">constraint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate constraints from arrays</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : ndarray</span>
<span class="sd">        Parameter loadings</span>
<span class="sd">    b : ndarray</span>
<span class="sd">        Constraint bounds</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    constraints : dict</span>
<span class="sd">        Dictionary of inequality constraints, one for each row of a</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Parameter constraints satisfy a.dot(parameters) - b &gt;= 0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">-</span> <span class="n">val</span>

        <span class="k">return</span> <span class="n">f</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">con</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">factory</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])}</span>
        <span class="n">constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">con</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">constraints</span>


<span class="k">def</span> <span class="nf">format_float_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_digits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Formats a floating point number so that if it can be well expressed</span>
<span class="sd">    in using a string with digits len, then it is converted simply, otherwise</span>
<span class="sd">    it is expressed in scientific notation&quot;&quot;&quot;</span>
    <span class="c1"># basic_format = &#39;{:0.&#39; + str(digits) + &#39;g}&#39;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;{:0.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">max_digits</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">decimal</span><span class="p">)</span> <span class="ow">or</span> <span class="n">scale</span> <span class="o">&lt;</span> <span class="o">-</span><span class="p">(</span><span class="n">decimal</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;{0:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_digits</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;e}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;{0:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_digits</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">decimal</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formatted</span>


<span class="k">def</span> <span class="nf">implicit_constant</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test a matrix for an implicit constant</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray</span>
<span class="sd">        Array to be tested</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    constant : bool</span>
<span class="sd">        Flag indicating whether the array has an implicit constant - whether</span>
<span class="sd">        the array has a set of columns that adds to a constant value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nobs</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nobs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">x</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">rank</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<div class="viewcode-block" id="ARCHModel"><a class="viewcode-back" href="../../../univariate/mean.html#arch.univariate.base.ARCHModel">[docs]</a><span class="nd">@add_metaclass</span><span class="p">(</span><span class="n">AbstractDocStringInheritor</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ARCHModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for mean models in ARCH processes.  Specifies the</span>
<span class="sd">    conditional mean process.</span>

<span class="sd">    All public methods that raise NotImplementedError should be overridden by</span>
<span class="sd">    any subclass.  Private methods that raise NotImplementedError are optional</span>
<span class="sd">    to override but recommended where applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># Set on model fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span> <span class="o">=</span> <span class="n">ensure1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span> <span class="o">=</span> <span class="n">ensure1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y_original</span> <span class="o">=</span> <span class="n">y</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hold_back</span> <span class="o">=</span> <span class="n">hold_back</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hold_back</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">hold_back</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">hold_back</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backcast</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">volatility</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span> <span class="o">=</span> <span class="n">volatility</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span> <span class="o">=</span> <span class="n">ConstantVariance</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">distribution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">distribution</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct linear constraint arrays  for use in non-linear optimization</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        a : ndarray</span>
<span class="sd">            Number of constraints by number of parameters loading array</span>
<span class="sd">        b : ndarray</span>
<span class="sd">            Number of constraints array of lower bounds</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Parameters satisfy a.dot(parameters) - b &gt;= 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct bounds for parameters to use in non-linear optimization</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bounds : list (2-tuple of float)</span>
<span class="sd">            Bounds for parameters to use in estimation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span>
        <span class="k">return</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span> <span class="o">*</span> <span class="n">num_params</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the dependent variable&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_original</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">volatility</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set or gets the volatility process</span>

<span class="sd">        Volatility processes must be a subclass of VolatilityProcess</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span>

    <span class="nd">@volatility</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">volatility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">VolatilityProcess</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must subclass VolatilityProcess&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set or gets the error distribution</span>

<span class="sd">        Distributions must be a subclass of Distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span>

    <span class="nd">@distribution</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Distribution</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must subclass Distribution&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_r2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the model r-square.  Optional to over-ride.  Must match</span>
<span class="sd">        signature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Subclasses optionally may provide.&quot;</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_fit_no_arch_normal_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;robust&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Must be overridden with closed form estimator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_fit_parameterless_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cov_type</span><span class="p">,</span> <span class="n">backcast</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When models have no parameters, fill return values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : ARCHModelResult</span>
<span class="sd">            Model result from parameterless model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span>
        <span class="c1"># Fake convergence results, see GH #87</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">OptimizeResult</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">param_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">cov_type</span> <span class="o">=</span> <span class="n">cov_type</span>
        <span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">resids</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">resids</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">var_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">variance_bounds</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="n">vol</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">compute_variance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span>
                                                                   <span class="n">var_bounds</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_parameter_names</span><span class="p">()</span>
        <span class="n">loglikelihood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_gaussian_loglikelihood</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>

        <span class="k">return</span> <span class="n">ARCHModelResult</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param_cov</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">cov_type</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">loglikelihood</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span><span class="p">,</span>
                               <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_loglikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">var_bounds</span><span class="p">,</span>
                       <span class="n">individual</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the log-likelihood using the entire model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parameters</span>
<span class="sd">        sigma2</span>
<span class="sd">        backcast</span>
<span class="sd">        individual : bool, optional</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        neg_llf : float</span>
<span class="sd">            Negative of model loglikelihood</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse parameters</span>
        <span class="k">global</span> <span class="n">_callback_func_count</span><span class="p">,</span> <span class="n">_callback_llf</span>
        <span class="n">_callback_func_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># 1. Resids</span>
        <span class="n">mp</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>

        <span class="c1"># 2. Compute sigma2 using VolatilityModel</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">compute_variance</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span>
                                                  <span class="n">var_bounds</span><span class="p">)</span>
        <span class="c1"># 3. Compute log likelihood using Distribution</span>
        <span class="n">llf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">loglikelihood</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">individual</span><span class="p">)</span>

        <span class="n">_callback_llf</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">llf</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">llf</span>

    <span class="k">def</span> <span class="nf">_all_parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list containing all parameter names from the mean model,</span>
<span class="sd">        volatility model and distribution&quot;&quot;&quot;</span>

        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_names</span><span class="p">()</span>
        <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">parameter_names</span><span class="p">())</span>
        <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">parameter_names</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">_parse_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the parameters of each model in a tuple&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">km</span><span class="p">,</span> <span class="n">kv</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">num_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="n">km</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">km</span><span class="p">:</span><span class="n">km</span> <span class="o">+</span> <span class="n">kv</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">km</span> <span class="o">+</span> <span class="n">kv</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">first_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows an ARCHModelFixedResult to be constructed from fixed parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : {ndarray, Series}</span>
<span class="sd">            User specified parameters to use when generating the result. Must</span>
<span class="sd">            have the correct number of parameters for a given choice of mean</span>
<span class="sd">            model, volatility model and distribution.</span>
<span class="sd">        first_obs : {int, str, datetime, Timestamp}</span>
<span class="sd">            First observation to use when fixing model</span>
<span class="sd">        last_obs : {int, str, datetime, Timestamp}</span>
<span class="sd">            Last observation to use when fixing model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : ARCHModelFixedResult</span>
<span class="sd">            Object containing model results</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Parameters are not checked against model-specific constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_sample</span><span class="p">(</span><span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span><span class="p">)</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starting_values</span><span class="p">())</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="n">backcast</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">backcast</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backcast</span> <span class="o">=</span> <span class="n">backcast</span>

        <span class="n">var_bounds</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">variance_bounds</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">loglikelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span>
                                                   <span class="n">var_bounds</span><span class="p">)</span>

        <span class="n">mp</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">compute_variance</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">var_bounds</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_parameter_names</span><span class="p">()</span>
        <span class="c1"># Reshape resids and vol</span>
        <span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="n">resids_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">resids_final</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">resids_final</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">resids</span>
        <span class="n">vol_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">vol_final</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">vol_final</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span>

        <span class="n">model_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ARCHModelFixedResult</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span>
                                    <span class="n">loglikelihood</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span><span class="p">,</span> <span class="n">model_copy</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_adjust_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs sample adjustment for estimation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        first_obs : {int, str, datetime, datetime64, Timestamp}</span>
<span class="sd">            First observation to use when estimating model</span>
<span class="sd">        last_obs : {int, str, datetime, datetime64, Timestamp}</span>
<span class="sd">            Last observation to use when estimating model</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Adjusted sample must follow Python semantics of first_obs:last_obs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="s1">&#39;final&#39;</span><span class="p">,</span> <span class="n">starting_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;robust&#39;</span><span class="p">,</span> <span class="n">show_warning</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">first_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">last_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">backcast</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fits the model given a nobs by 1 vector of sigma2 values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        update_freq : int, optional</span>
<span class="sd">            Frequency of iteration updates.  Output is generated every</span>
<span class="sd">            `update_freq` iterations. Set to 0 to disable iterative output.</span>
<span class="sd">        disp : str</span>
<span class="sd">            Either &#39;final&#39; to print optimization result or &#39;off&#39; to display</span>
<span class="sd">            nothing</span>
<span class="sd">        starting_values : ndarray, optional</span>
<span class="sd">            Array of starting values to use.  If not provided, starting values</span>
<span class="sd">            are constructed by the model components.</span>
<span class="sd">        cov_type : str, optional</span>
<span class="sd">            Estimation method of parameter covariance.  Supported options are</span>
<span class="sd">            &#39;robust&#39;, which does not assume the Information Matrix Equality</span>
<span class="sd">            holds and &#39;classic&#39; which does.  In the ARCH literature, &#39;robust&#39;</span>
<span class="sd">            corresponds to Bollerslev-Wooldridge covariance estimator.</span>
<span class="sd">        show_warning : bool, optional</span>
<span class="sd">            Flag indicating whether convergence warnings should be shown.</span>
<span class="sd">        first_obs : {int, str, datetime, Timestamp}</span>
<span class="sd">            First observation to use when estimating model</span>
<span class="sd">        last_obs : {int, str, datetime, Timestamp}</span>
<span class="sd">            Last observation to use when estimating model</span>
<span class="sd">        tol : float, optional</span>
<span class="sd">            Tolerance for termination.</span>
<span class="sd">        options : dict, optional</span>
<span class="sd">            Options to pass to `scipy.optimize.minimize`.  Valid entries</span>
<span class="sd">            include &#39;ftol&#39;, &#39;eps&#39;, &#39;disp&#39;, and &#39;maxiter&#39;.</span>
<span class="sd">        backcast : float, optional</span>
<span class="sd">            Value to use as backcast. Should be measure :math:`\sigma^2_0`</span>
<span class="sd">            since model-specific non-linear transformations are applied to</span>
<span class="sd">            value before computing the variance recusions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        results : ARCHModelResult</span>
<span class="sd">            Object containing model results</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        A ConvergenceWarning is raised if SciPy&#39;s optimizer indicates</span>
<span class="sd">        difficulty finding the optimum.</span>

<span class="sd">        Parameters are optimized using SLSQP.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_original</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Cannot estimate model without data.&#39;</span><span class="p">)</span>
        <span class="c1"># 1. Check in ARCH or Non-normal dist.  If no ARCH and normal,</span>
        <span class="c1"># use closed form</span>
        <span class="n">v</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">num_params</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">num_params</span><span class="p">))</span>
        <span class="n">total_params</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
        <span class="c1"># Closed form is applicable when model has no parameters</span>
        <span class="c1"># Or when distribution is normal and constant variance</span>

        <span class="n">has_closed_form</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">closed_form</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">num_params</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ConstantVariance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_sample</span><span class="p">(</span><span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span><span class="p">)</span>

        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starting_values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">backcast</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backcast</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">backcast</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backcast</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">backcast_transform</span><span class="p">(</span><span class="n">backcast</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_closed_form</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_no_arch_normal_errors</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="n">total_params</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_parameterless_model</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="n">cov_type</span><span class="p">,</span> <span class="n">backcast</span><span class="o">=</span><span class="n">backcast</span><span class="p">)</span>

        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_backcast</span> <span class="o">=</span> <span class="n">backcast</span>
        <span class="n">sv_volatility</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">starting_values</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_var_bounds</span> <span class="o">=</span> <span class="n">var_bounds</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">variance_bounds</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="n">v</span><span class="o">.</span><span class="n">compute_variance</span><span class="p">(</span><span class="n">sv_volatility</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">var_bounds</span><span class="p">)</span>
        <span class="n">std_resids</span> <span class="o">=</span> <span class="n">resids</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span>

        <span class="c1"># 2. Construct constraint matrices from all models and distribution</span>
        <span class="n">constraints</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">(),</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">constraints</span><span class="p">(),</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">constraints</span><span class="p">())</span>

        <span class="n">num_constraints</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">]</span>
        <span class="n">num_constraints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">num_constraints</span><span class="p">)</span>
        <span class="n">num_params</span> <span class="o">=</span> <span class="n">offsets</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_constraints</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">num_params</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_constraints</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">constraints</span><span class="p">):</span>
            <span class="n">r_en</span> <span class="o">=</span> <span class="n">num_constraints</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">c_en</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">r_st</span> <span class="o">=</span> <span class="n">r_en</span> <span class="o">-</span> <span class="n">num_constraints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">c_st</span> <span class="o">=</span> <span class="n">c_en</span> <span class="o">-</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">r_en</span> <span class="o">-</span> <span class="n">r_st</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">r_st</span><span class="p">:</span><span class="n">r_en</span><span class="p">,</span> <span class="n">c_st</span><span class="p">:</span><span class="n">c_en</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">b</span><span class="p">[</span><span class="n">r_st</span><span class="p">:</span><span class="n">r_en</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span><span class="p">()</span>
        <span class="n">bounds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">resids</span><span class="p">))</span>
        <span class="n">bounds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">bounds</span><span class="p">(</span><span class="n">std_resids</span><span class="p">))</span>

        <span class="c1"># 3. Construct starting values from all models</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="n">starting_values</span>
        <span class="k">if</span> <span class="n">starting_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="n">ensure1d</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span> <span class="s1">&#39;starting_values&#39;</span><span class="p">)</span>
            <span class="n">valid</span> <span class="o">=</span> <span class="p">(</span><span class="n">sv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">satisfies_constraints</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">satisfies_constraints</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bound</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span> <span class="ow">and</span> <span class="n">bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">starting_value_warning</span><span class="p">,</span> <span class="n">StartingValueWarning</span><span class="p">)</span>
                <span class="n">starting_values</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">starting_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starting_values</span><span class="p">(),</span>
                  <span class="n">sv_volatility</span><span class="p">,</span>
                  <span class="n">d</span><span class="o">.</span><span class="n">starting_values</span><span class="p">(</span><span class="n">std_resids</span><span class="p">))</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>

        <span class="c1"># 4. Estimate models using constrained optimization</span>
        <span class="k">global</span> <span class="n">_callback_func_count</span><span class="p">,</span> <span class="n">_callback_iter</span><span class="p">,</span> <span class="n">_callback_iter_display</span>
        <span class="n">_callback_func_count</span><span class="p">,</span> <span class="n">_callback_iter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">update_freq</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">disp</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">:</span>
            <span class="n">_callback_iter_display</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">31</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">_callback_iter_display</span> <span class="o">=</span> <span class="n">update_freq</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">disp</span> <span class="o">==</span> <span class="s1">&#39;final&#39;</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelihood</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma2</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">var_bounds</span><span class="p">)</span>
        <span class="n">ineq_constraints</span> <span class="o">=</span> <span class="n">constraint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">minimize</span>

        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">options</span>
        <span class="n">options</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="n">disp</span><span class="p">)</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">sv</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                       <span class="n">constraints</span><span class="o">=</span><span class="n">ineq_constraints</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">_callback</span><span class="p">,</span>
                       <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">show_warning</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;always&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ConvergenceWarning</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ConvergenceWarning</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">show_warning</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">convergence_warning</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                                                     <span class="n">string_message</span><span class="o">=</span><span class="n">opt</span><span class="o">.</span><span class="n">message</span><span class="p">),</span>
                          <span class="n">ConvergenceWarning</span><span class="p">)</span>

        <span class="c1"># 5. Return results</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">x</span>
        <span class="n">loglikelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">opt</span><span class="o">.</span><span class="n">fun</span>

        <span class="n">mp</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">compute_variance</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">var_bounds</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_parameter_names</span><span class="p">()</span>
        <span class="c1"># Reshape resids and vol</span>
        <span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="n">resids_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">resids_final</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">resids_final</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">resids</span>
        <span class="n">vol_final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">vol_final</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">vol_final</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span>

        <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="n">model_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ARCHModelResult</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">resids_final</span><span class="p">,</span> <span class="n">vol_final</span><span class="p">,</span>
                               <span class="n">cov_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">loglikelihood</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span><span class="p">,</span> <span class="n">model_copy</span><span class="p">)</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List of parameters names</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        names : list (str)</span>
<span class="sd">            List of variable names for the mean model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">starting_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns starting values for the mean model, often the same as the</span>
<span class="sd">        values returned from fit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sv : ndarray</span>
<span class="sd">            Starting values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fit_no_arch_normal_errors</span><span class="p">()</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
        <span class="c1"># Remove sigma2</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@abstractmethod</span>
    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of parameters in the model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">initial_value_vol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">resids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regressors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute model residuals</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            Model parameters</span>
<span class="sd">        y : ndarray, optional</span>
<span class="sd">            Alternative values to use when computing model residuals</span>
<span class="sd">        regressors : ndarray, optional</span>
<span class="sd">            Alternative regressor values to use when computing model residuals</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        resids : ndarray</span>
<span class="sd">            Model residuals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">compute_param_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">backcast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes parameter covariances using numerical derivatives.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            Model parameters</span>
<span class="sd">        backcast : float</span>
<span class="sd">            Value to use for pre-sample observations</span>
<span class="sd">        robust : bool, optional</span>
<span class="sd">            Flag indicating whether to use robust standard errors (True) or</span>
<span class="sd">            classic MLE (False)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">starting_values</span><span class="p">())</span>
        <span class="n">var_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">variance_bounds</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="n">resids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">backcast</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backcast</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backcast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">backcast</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_backcast</span> <span class="o">=</span> <span class="n">backcast</span>
        <span class="k">elif</span> <span class="n">backcast</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">backcast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backcast</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sigma2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">resids</span><span class="p">),</span>
                  <span class="s1">&#39;backcast&#39;</span><span class="p">:</span> <span class="n">backcast</span><span class="p">,</span>
                  <span class="s1">&#39;var_bounds&#39;</span><span class="p">:</span> <span class="n">var_bounds</span><span class="p">,</span>
                  <span class="s1">&#39;individual&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>

        <span class="n">hess</span> <span class="o">=</span> <span class="n">approx_hess</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelihood</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">hess</span> <span class="o">/=</span> <span class="n">nobs</span>
        <span class="n">inv_hess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">hess</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">robust</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;individual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">approx_fprime</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelihood</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: np.ndarray</span>
            <span class="n">score_cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">inv_hess</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">score_cov</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">inv_hess</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inv_hess</span> <span class="o">/</span> <span class="n">nobs</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;analytic&#39;</span><span class="p">,</span>
                 <span class="n">simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct forecasts from estimated model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : {ndarray, Series}, optional</span>
<span class="sd">            Alternative parameters to use.  If not provided, the parameters</span>
<span class="sd">            estimated when fitting the model are used.  Must be identical in</span>
<span class="sd">            shape to the parameters computed by fitting the model.</span>
<span class="sd">        horizon : int, optional</span>
<span class="sd">           Number of steps to forecast</span>
<span class="sd">        start : {int, datetime, Timestamp, str}, optional</span>
<span class="sd">            An integer, datetime or str indicating the first observation to</span>
<span class="sd">            produce the forecast for.  Datetimes can only be used with pandas</span>
<span class="sd">            inputs that have a datetime index. Strings must be convertible</span>
<span class="sd">            to a date time, such as in &#39;1945-01-01&#39;.</span>
<span class="sd">        align : str, optional</span>
<span class="sd">            Either &#39;origin&#39; or &#39;target&#39;.  When set of &#39;origin&#39;, the t-th row</span>
<span class="sd">            of forecasts contains the forecasts for t+1, t+2, ..., t+h. When</span>
<span class="sd">            set to &#39;target&#39;, the t-th row contains the 1-step ahead forecast</span>
<span class="sd">            from time t-1, the 2 step from time t-2, ..., and the h-step from</span>
<span class="sd">            time t-h.  &#39;target&#39; simplified computing forecast errors since the</span>
<span class="sd">            realization and h-step forecast are aligned.</span>
<span class="sd">        method : {&#39;analytic&#39;, &#39;simulation&#39;, &#39;bootstrap&#39;}</span>
<span class="sd">            Method to use when producing the forecast. The default is analytic.</span>
<span class="sd">            The method only affects the variance forecast generation.  Not all</span>
<span class="sd">            volatility models support all methods. In particular, volatility</span>
<span class="sd">            models that do not evolve in squares such as EGARCH or TARCH do not</span>
<span class="sd">            support the &#39;analytic&#39; method for horizons &gt; 1.</span>
<span class="sd">        simulations : int</span>
<span class="sd">            Number of simulations to run when computing the forecast using</span>
<span class="sd">            either simulation or bootstrap.</span>
<span class="sd">        rng : callable, optional</span>
<span class="sd">            Custom random number generator to use in simulation-based forecasts.</span>
<span class="sd">            Must produce random samples using the syntax `rng(size)` where size</span>
<span class="sd">            the 2-element tuple (simulations, horizon).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forecasts : ARCHModelForecast</span>
<span class="sd">            t by h data frame containing the forecasts.  The alignment of the</span>
<span class="sd">            forecasts is controlled by `align`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; from arch import arch_model</span>
<span class="sd">        &gt;&gt;&gt; am = arch_model(None,mean=&#39;HAR&#39;,lags=[1,5,22],vol=&#39;Constant&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sim_data = am.simulate([0.1,0.4,0.3,0.2,1.0], 250)</span>
<span class="sd">        &gt;&gt;&gt; sim_data.index = pd.date_range(&#39;2000-01-01&#39;,periods=250)</span>
<span class="sd">        &gt;&gt;&gt; am = arch_model(sim_data[&#39;data&#39;],mean=&#39;HAR&#39;,lags=[1,5,22],  vol=&#39;Constant&#39;)</span>
<span class="sd">        &gt;&gt;&gt; res = am.fit()</span>
<span class="sd">        &gt;&gt;&gt; fig = res.hedgehog_plot()</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The most basic 1-step ahead forecast will return a vector with the same</span>
<span class="sd">        length as the original data, where the t-th value will be the time-t</span>
<span class="sd">        forecast for time t + 1.  When the horizon is &gt; 1, and when using the</span>
<span class="sd">        default value for `align`, the forecast value in position [t, h] is the</span>
<span class="sd">        time-t, h+1 step ahead forecast.</span>

<span class="sd">        If model contains exogenous variables (model.x is not None), then</span>
<span class="sd">        only 1-step ahead forecasts are available.  Using horizon &gt; 1 will</span>
<span class="sd">        produce a warning and all columns, except the first, will be</span>
<span class="sd">        nan-filled.</span>

<span class="sd">        If `align` is &#39;origin&#39;, forecast[t,h] contains the forecast made using</span>
<span class="sd">        y[:t] (that is, up to but not including t) for horizon h + 1.  For</span>
<span class="sd">        example, y[100,2] contains the 3-step ahead forecast using the first</span>
<span class="sd">        100 data points, which will correspond to the realization y[100 + 2].</span>
<span class="sd">        If `align` is &#39;target&#39;, then the same forecast is in location</span>
<span class="sd">        [102, 2], so that it is aligned with the observation to use when</span>
<span class="sd">        evaluating, but still in the same column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>


<span class="k">class</span> <span class="nc">_SummaryRepr</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for returning summary as repr and str&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Subclasses must implement&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;, id: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">as_text</span><span class="p">()</span>


<div class="viewcode-block" id="ARCHModelFixedResult"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelFixedResult">[docs]</a><span class="k">class</span> <span class="nc">ARCHModelFixedResult</span><span class="p">(</span><span class="n">_SummaryRepr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results for fixed parameters for an ARCHModel model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params : ndarray</span>
<span class="sd">        Estimated parameters</span>
<span class="sd">    resid : ndarray</span>
<span class="sd">        Residuals from model.  Residuals have same shape as original data and</span>
<span class="sd">        contain nan-values in locations not used in estimation</span>
<span class="sd">    volatility : ndarray</span>
<span class="sd">        Conditional volatility from model</span>
<span class="sd">    dep_var : Series</span>
<span class="sd">        Dependent variable</span>
<span class="sd">    names : list (str)</span>
<span class="sd">        Model parameter names</span>
<span class="sd">    loglikelihood : float</span>
<span class="sd">        Loglikelihood at specified parameters</span>
<span class="sd">    is_pandas : bool</span>
<span class="sd">        Whether the original input was pandas</span>
<span class="sd">    model : ARCHModel</span>
<span class="sd">        The model object used to estimate the parameters</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    summary</span>
<span class="sd">        Produce a summary of the results</span>
<span class="sd">    plot</span>
<span class="sd">        Produce a plot of the volatility and standardized residuals</span>
<span class="sd">    forecast</span>
<span class="sd">        Construct forecasts from a model</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    loglikelihood : float</span>
<span class="sd">        Value of the log-likelihood</span>
<span class="sd">    params : Series</span>
<span class="sd">        Estimated parameters</span>
<span class="sd">    resid : {ndarray, Series}</span>
<span class="sd">        nobs element array containing model residuals</span>
<span class="sd">    model : ARCHModel</span>
<span class="sd">        Model instance used to produce the fit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">volatility</span><span class="p">,</span> <span class="n">dep_var</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span>
                 <span class="n">loglikelihood</span><span class="p">,</span> <span class="n">is_pandas</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resid</span> <span class="o">=</span> <span class="n">resid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span> <span class="o">=</span> <span class="n">is_pandas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span> <span class="o">=</span> <span class="n">dep_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dep_name</span> <span class="o">=</span> <span class="n">dep_var</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelihood</span> <span class="o">=</span> <span class="n">loglikelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_fit_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">dep_var</span><span class="o">.</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span> <span class="o">=</span> <span class="n">volatility</span>

<div class="viewcode-block" id="ARCHModelFixedResult.summary"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelFixedResult.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a summary of the results from a fit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        summary : Summary instance</span>
<span class="sd">            Object that contains tables and facilitated export to text, html or</span>
<span class="sd">            latex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Summary layout</span>
        <span class="c1"># 1. Overall information</span>
        <span class="c1"># 2. Mean parameters</span>
        <span class="c1"># 3. Volatility parameters</span>
        <span class="c1"># 4. Distribution parameters</span>
        <span class="c1"># 5. Notes</span>

        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Summary Header</span>
        <span class="n">top_left</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Dep. Variable:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Mean Model:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Vol Model:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Distribution:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Method:&#39;</span><span class="p">,</span> <span class="s1">&#39;User-specified Parameters&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Date:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, %b </span><span class="si">%d</span><span class="s1"> %Y&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s1">&#39;Time:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">))]</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;R-squared:&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Adj. R-squared:&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Log-Likelihood:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#10.6g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglikelihood</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;AIC:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#10.6g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">aic</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;BIC:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#10.6g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;No. Observations:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="p">]</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39; Model Results&#39;</span>
        <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stub</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">top_left</span><span class="p">:</span>
            <span class="n">stubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stub</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">txt_fmt</span><span class="o">=</span><span class="n">fmt_2cols</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">stubs</span><span class="o">=</span><span class="n">stubs</span><span class="p">)</span>

        <span class="c1"># create summary table instance</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>
        <span class="c1"># Top Table</span>
        <span class="c1"># Parameter table</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt_2cols</span>
        <span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;data_fmts&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%18s</span><span class="s1">&#39;</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;</span><span class="si">%-21s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">top_right</span><span class="p">]</span>
        <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stub</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">top_right</span><span class="p">:</span>
            <span class="n">stubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stub</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
        <span class="n">table</span><span class="o">.</span><span class="n">extend_right</span><span class="p">(</span><span class="n">SimpleTable</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">stubs</span><span class="o">=</span><span class="n">stubs</span><span class="p">))</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="n">stubs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,)</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_table_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="n">format_float_fixed</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">*</span><span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converted</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">param_table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">vc</span><span class="p">,</span> <span class="n">dc</span><span class="p">)</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Mean Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Volatility Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Distribution&#39;</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">table_data</span> <span class="o">=</span> <span class="n">param_table_data</span><span class="p">[</span><span class="n">total</span><span class="p">:</span><span class="n">total</span> <span class="o">+</span> <span class="n">count</span><span class="p">]</span>
            <span class="n">table_stubs</span> <span class="o">=</span> <span class="n">stubs</span><span class="p">[</span><span class="n">total</span><span class="p">:</span><span class="n">total</span> <span class="o">+</span> <span class="n">count</span><span class="p">]</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">count</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span>
                                <span class="n">stubs</span><span class="o">=</span><span class="n">table_stubs</span><span class="p">,</span>
                                <span class="n">txt_fmt</span><span class="o">=</span><span class="n">fmt_params</span><span class="p">,</span>
                                <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="n">extra_text</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Results generated with user-specified parameters.&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;Std. errors not available when the model is not estimated, &#39;</span><span class="p">]</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">add_extra_txt</span><span class="p">(</span><span class="n">extra_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">smry</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">loglikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model loglikelihood&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglikelihood</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">aic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Akaike Information Criteria</span>

<span class="sd">        -2 * loglikelihood + 2 * num_params&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglikelihood</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number of parameters in model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">bic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Schwarz/Bayesian Information Criteria</span>

<span class="sd">        -2 * loglikelihood + log(nobs) * num_params</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglikelihood</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Model Parameters&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;params&#39;</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">conditional_volatility</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimated conditional volatility</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        conditional_volatility : {ndarray, Series}</span>
<span class="sd">            nobs element array containing the conditional volatility (square</span>
<span class="sd">            root of conditional variance).  The values are aligned with the</span>
<span class="sd">            input data so that the value in the t-th position is the variance</span>
<span class="sd">            of t-th error, which is computed using time-(t-1) information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cond_vol&#39;</span><span class="p">,</span>
                             <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">nobs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of data points used to estimate model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">resid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Model residuals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resid</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;resid&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resid</span>

<div class="viewcode-block" id="ARCHModelFixedResult.plot"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelFixedResult.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annualize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot standardized residuals and conditional volatility</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        annualize : str, optional</span>
<span class="sd">            String containing frequency of data that indicates plot should</span>
<span class="sd">            contain annualized volatility.  Supported values are &#39;D&#39; (daily),</span>
<span class="sd">            &#39;W&#39; (weekly) and &#39;M&#39; (monthly), which scale variance by 252, 52,</span>
<span class="sd">            and 12, respectively.</span>
<span class="sd">        scale : float, optional</span>
<span class="sd">            Value to use when scaling returns to annualize.  If scale is</span>
<span class="sd">            provides, annualize is ignored and the value in scale is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : figure</span>
<span class="sd">            Handle to the figure</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from arch import arch_model</span>
<span class="sd">        &gt;&gt;&gt; am = arch_model(None)</span>
<span class="sd">        &gt;&gt;&gt; sim_data = am.simulate([0.0, 0.01, 0.07, 0.92], 2520)</span>
<span class="sd">        &gt;&gt;&gt; am = arch_model(sim_data[&#39;data&#39;])</span>
<span class="sd">        &gt;&gt;&gt; res = am.fit(update_freq=0, disp=&#39;off&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fig = res.plot()</span>

<span class="sd">        Produce a plot with annualized volatility</span>

<span class="sd">        &gt;&gt;&gt; fig = res.plot(annualize=&#39;D&#39;)</span>

<span class="sd">        Override the usual scale of 252 to use 360 for an asset that trades</span>
<span class="sd">        most days of the year</span>

<span class="sd">        &gt;&gt;&gt; fig = res.plot(scale=360)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="k">import</span> <span class="n">figure</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">()</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resid</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_volatility</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Standardized Residuals&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditional_volatility</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Annualized Conditional Volatility&#39;</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">annualize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">252</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">annualize</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
                <span class="n">vol</span> <span class="o">=</span> <span class="n">vol</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scales</span><span class="p">[</span><span class="n">annualize</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;annualize not recognized&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Conditional Volatility&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="ARCHModelFixedResult.forecast"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelFixedResult.forecast">[docs]</a>    <span class="k">def</span> <span class="nf">forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;analytic&#39;</span><span class="p">,</span>
                 <span class="n">simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct forecasts from estimated model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray, optional</span>
<span class="sd">            Alternative parameters to use.  If not provided, the parameters</span>
<span class="sd">            estimated when fitting the model are used.  Must be identical in</span>
<span class="sd">            shape to the parameters computed by fitting the model.</span>
<span class="sd">        horizon : int, optional</span>
<span class="sd">           Number of steps to forecast</span>
<span class="sd">        start : {int, datetime, Timestamp, str}, optional</span>
<span class="sd">            An integer, datetime or str indicating the first observation to</span>
<span class="sd">            produce the forecast for.  Datetimes can only be used with pandas</span>
<span class="sd">            inputs that have a datetime index. Strings must be convertible</span>
<span class="sd">            to a date time, such as in &#39;1945-01-01&#39;.</span>
<span class="sd">        align : str, optional</span>
<span class="sd">            Either &#39;origin&#39; or &#39;target&#39;.  When set of &#39;origin&#39;, the t-th row</span>
<span class="sd">            of forecasts contains the forecasts for t+1, t+2, ..., t+h. When</span>
<span class="sd">            set to &#39;target&#39;, the t-th row contains the 1-step ahead forecast</span>
<span class="sd">            from time t-1, the 2 step from time t-2, ..., and the h-step from</span>
<span class="sd">            time t-h.  &#39;target&#39; simplified computing forecast errors since the</span>
<span class="sd">            realization and h-step forecast are aligned.</span>
<span class="sd">        method : {&#39;analytic&#39;, &#39;simulation&#39;, &#39;bootstrap&#39;}, optional</span>
<span class="sd">            Method to use when producing the forecast. The default is analytic.</span>
<span class="sd">            The method only affects the variance forecast generation.  Not all</span>
<span class="sd">            volatility models support all methods. In particular, volatility</span>
<span class="sd">            models that do not evolve in squares such as EGARCH or TARCH do not</span>
<span class="sd">            support the &#39;analytic&#39; method for horizons &gt; 1.</span>
<span class="sd">        simulations : int, optional</span>
<span class="sd">            Number of simulations to run when computing the forecast using</span>
<span class="sd">            either simulation or bootstrap.</span>
<span class="sd">        rng : callable, optional</span>
<span class="sd">            Custom random number generator to use in simulation-based forecasts.</span>
<span class="sd">            Must produce random samples using the syntax `rng(size)` where size</span>
<span class="sd">            the 2-element tuple (simulations, horizon).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        forecasts : ARCHModelForecast</span>
<span class="sd">            t by h data frame containing the forecasts.  The alignment of the</span>
<span class="sd">            forecasts is controlled by `align`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The most basic 1-step ahead forecast will return a vector with the same</span>
<span class="sd">        length as the original data, where the t-th value will be the time-t</span>
<span class="sd">        forecast for time t + 1.  When the horizon is &gt; 1, and when using the</span>
<span class="sd">        default value for `align`, the forecast value in position [t, h] is the</span>
<span class="sd">        time-t, h+1 step ahead forecast.</span>

<span class="sd">        If model contains exogenous variables (`model.x is not None`), then</span>
<span class="sd">        only 1-step ahead forecasts are available.  Using horizon &gt; 1 will</span>
<span class="sd">        produce a warning and all columns, except the first, will be</span>
<span class="sd">        nan-filled.</span>

<span class="sd">        If `align` is &#39;origin&#39;, forecast[t,h] contains the forecast made using</span>
<span class="sd">        y[:t] (that is, up to but not including t) for horizon h + 1.  For</span>
<span class="sd">        example, y[100,2] contains the 3-step ahead forecast using the first</span>
<span class="sd">        100 data points, which will correspond to the realization y[100 + 2].</span>
<span class="sd">        If `align` is &#39;target&#39;, then the same forecast is in location</span>
<span class="sd">        [102, 2], so that it is aligned with the observation to use when</span>
<span class="sd">        evaluating, but still in the same column.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="ow">or</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_params</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;params have incorrect dimensions&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">simulations</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCHModelFixedResult.hedgehog_plot"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelFixedResult.hedgehog_plot">[docs]</a>    <span class="k">def</span> <span class="nf">hedgehog_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;volatility&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;analytic&#39;</span><span class="p">,</span> <span class="n">simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot forecasts from estimated model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : {ndarray, Series}</span>
<span class="sd">            Alternative parameters to use.  If not provided, the parameters</span>
<span class="sd">            computed by fitting the model are used.  Must be 1-d and identical</span>
<span class="sd">            in shape to the parameters computed by fitting the model.</span>
<span class="sd">        horizon : int, optional</span>
<span class="sd">            Number of steps to forecast</span>
<span class="sd">        step : int, optional</span>
<span class="sd">            Non-negative number of forecasts to skip between spines</span>
<span class="sd">        start : int, datetime or str, optional</span>
<span class="sd">            An integer, datetime or str indicating the first observation to</span>
<span class="sd">            produce the forecast for.  Datetimes can only be used with pandas</span>
<span class="sd">            inputs that have a datetime index.  Strings must be convertible</span>
<span class="sd">            to a date time, such as in &#39;1945-01-01&#39;.  If not provided, the start</span>
<span class="sd">            is set to the earliest forecastable date.</span>
<span class="sd">        type : {&#39;volatility&#39;, &#39;mean&#39;}</span>
<span class="sd">            Quantity to plot, the forecast volatility or the forecast mean</span>
<span class="sd">        method : {&#39;analytic&#39;, &#39;simulation&#39;, &#39;bootstrap&#39;}</span>
<span class="sd">            Method to use when producing the forecast. The default is analytic.</span>
<span class="sd">            The method only affects the variance forecast generation.  Not all</span>
<span class="sd">            volatility models support all methods. In particular, volatility</span>
<span class="sd">            models that do not evolve in squares such as EGARCH or TARCH do not</span>
<span class="sd">            support the &#39;analytic&#39; method for horizons &gt; 1.</span>
<span class="sd">        simulations : int</span>
<span class="sd">            Number of simulations to run when computing the forecast using</span>
<span class="sd">            either simulation or bootstrap.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : figure</span>
<span class="sd">            Handle to the figure</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; from arch import arch_model</span>
<span class="sd">        &gt;&gt;&gt; am = arch_model(None,mean=&#39;HAR&#39;,lags=[1,5,22],vol=&#39;Constant&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sim_data = am.simulate([0.1,0.4,0.3,0.2,1.0], 250)</span>
<span class="sd">        &gt;&gt;&gt; sim_data.index = pd.date_range(&#39;2000-01-01&#39;,periods=250)</span>
<span class="sd">        &gt;&gt;&gt; am = arch_model(sim_data[&#39;data&#39;],mean=&#39;HAR&#39;,lags=[1,5,22],  vol=&#39;Constant&#39;)</span>
<span class="sd">        &gt;&gt;&gt; res = am.fit()</span>
<span class="sd">        &gt;&gt;&gt; fig = res.hedgehog_plot(type=&#39;mean&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="n">plot_mean</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">invalid_start</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">invalid_start</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span>
                                              <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">)</span>
                    <span class="n">invalid_start</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                      <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">use_date</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">)</span>
        <span class="n">plot_fn</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_date</span> <span class="k">if</span> <span class="n">use_date</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span>
        <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_mean</span><span class="p">:</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_var</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conditional_volatility</span><span class="p">)</span>

        <span class="n">plot_fn</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">first_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">forecasts</span><span class="o">.</span><span class="n">mean</span><span class="p">)))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">spines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">first_obs</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="n">horizon</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">x_values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="n">temp_x</span> <span class="o">=</span> <span class="n">x_values</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">horizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">plot_mean</span><span class="p">:</span>
                <span class="n">spine_data</span> <span class="o">=</span> <span class="n">forecasts</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">spine_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">forecasts</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">temp_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">y_values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">spine_data</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">plot_fn</span><span class="p">(</span><span class="n">temp_x</span><span class="p">,</span> <span class="n">temp_y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
                           <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">spines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">spines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">spines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">spine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;Mean&#39;</span> <span class="k">if</span> <span class="n">plot_mean</span> <span class="k">else</span> <span class="s1">&#39;Volatility&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dep_name</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">plot_type</span> <span class="o">+</span> <span class="s1">&#39; Forecast Hedgehog Plot&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span></div></div>


<div class="viewcode-block" id="ARCHModelResult"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelResult">[docs]</a><span class="k">class</span> <span class="nc">ARCHModelResult</span><span class="p">(</span><span class="n">ARCHModelFixedResult</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results from estimation of an ARCHModel model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    params : ndarray</span>
<span class="sd">        Estimated parameters</span>
<span class="sd">    param_cov : {ndarray, None}</span>
<span class="sd">        Estimated variance-covariance matrix of params.  If none, calls method</span>
<span class="sd">        to compute variance from model when parameter covariance is first used</span>
<span class="sd">        from result</span>
<span class="sd">    r2 : float</span>
<span class="sd">        Model R-squared</span>
<span class="sd">    resid : ndarray</span>
<span class="sd">        Residuals from model.  Residuals have same shape as original data and</span>
<span class="sd">        contain nan-values in locations not used in estimation</span>
<span class="sd">    volatility : ndarray</span>
<span class="sd">        Conditional volatility from model</span>
<span class="sd">    cov_type : str</span>
<span class="sd">        String describing the covariance estimator used</span>
<span class="sd">    dep_var : Series</span>
<span class="sd">        Dependent variable</span>
<span class="sd">    names : list (str)</span>
<span class="sd">        Model parameter names</span>
<span class="sd">    loglikelihood : float</span>
<span class="sd">        Loglikelihood at estimated parameters</span>
<span class="sd">    is_pandas : bool</span>
<span class="sd">        Whether the original input was pandas</span>
<span class="sd">    fit_start : int</span>
<span class="sd">        Integer index of the first observation used to fit the model</span>
<span class="sd">    fit_stop : int</span>
<span class="sd">        Integer index of the last observation used to fit the model using</span>
<span class="sd">        slice notation `fit_start:fit_stop`</span>
<span class="sd">    model : ARCHModel</span>
<span class="sd">        The model object used to estimate the parameters</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    summary</span>
<span class="sd">        Produce a summary of the results</span>
<span class="sd">    plot</span>
<span class="sd">        Produce a plot of the volatility and standardized residuals</span>
<span class="sd">    conf_int</span>
<span class="sd">        Confidence intervals</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    loglikelihood : float</span>
<span class="sd">        Value of the log-likelihood</span>
<span class="sd">    params : Series</span>
<span class="sd">        Estimated parameters</span>
<span class="sd">    param_cov : DataFrame</span>
<span class="sd">        Estimated variance-covariance of the parameters</span>
<span class="sd">    resid : {ndarray, Series}</span>
<span class="sd">        nobs element array containing model residuals</span>
<span class="sd">    model : ARCHModel</span>
<span class="sd">        Model instance used to produce the fit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_cov</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">volatility</span><span class="p">,</span> <span class="n">cov_type</span><span class="p">,</span>
                 <span class="n">dep_var</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">loglikelihood</span><span class="p">,</span> <span class="n">is_pandas</span><span class="p">,</span> <span class="n">optim_output</span><span class="p">,</span>
                 <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ARCHModelResult</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">volatility</span><span class="p">,</span>
                                              <span class="n">dep_var</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">loglikelihood</span><span class="p">,</span>
                                              <span class="n">is_pandas</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_cov</span> <span class="o">=</span> <span class="n">param_cov</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r2</span> <span class="o">=</span> <span class="n">r2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span> <span class="o">=</span> <span class="n">cov_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_optim_output</span> <span class="o">=</span> <span class="n">optim_output</span>

<div class="viewcode-block" id="ARCHModelResult.conf_int"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelResult.conf_int">[docs]</a>    <span class="k">def</span> <span class="nf">conf_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : float, optional</span>
<span class="sd">            Size (prob.) to use when constructing the confidence interval.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ci : ndarray</span>
<span class="sd">            Array where the ith row contains the confidence interval  for the</span>
<span class="sd">            ith parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">se</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_err</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">params</span> <span class="o">-</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span> <span class="o">+</span> <span class="n">cv</span> <span class="o">*</span> <span class="n">se</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="ARCHModelResult.summary"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.univariate.base.ARCHModelResult.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructs a summary of the results from a fit model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        summary : Summary instance</span>
<span class="sd">            Object that contains tables and facilitated export to text, html or</span>
<span class="sd">            latex</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Summary layout</span>
        <span class="c1"># 1. Overall information</span>
        <span class="c1"># 2. Mean parameters</span>
        <span class="c1"># 3. Volatility parameters</span>
        <span class="c1"># 4. Distribution parameters</span>
        <span class="c1"># 5. Notes</span>

        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Summary Header</span>
        <span class="n">top_left</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Dep. Variable:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dep_name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Mean Model:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Vol Model:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Distribution:&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Method:&#39;</span><span class="p">,</span> <span class="s1">&#39;Maximum Likelihood&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;Date:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">, %b </span><span class="si">%d</span><span class="s1"> %Y&#39;</span><span class="p">)),</span>
                    <span class="p">(</span><span class="s1">&#39;Time:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">))]</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;R-squared:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#8.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Adj. R-squared:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#8.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsquared_adj</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Log-Likelihood:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#10.6g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglikelihood</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;AIC:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#10.6g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">aic</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;BIC:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%#10.6g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">bic</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;No. Observations:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nobs</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Df Residuals:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;Df Model:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">)]</span>

        <span class="n">title</span> <span class="o">=</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39; Model Results&#39;</span>
        <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stub</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">top_left</span><span class="p">:</span>
            <span class="n">stubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stub</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">txt_fmt</span><span class="o">=</span><span class="n">fmt_2cols</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">stubs</span><span class="o">=</span><span class="n">stubs</span><span class="p">)</span>

        <span class="c1"># create summary table instance</span>
        <span class="n">smry</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">()</span>
        <span class="c1"># Top Table</span>
        <span class="c1"># Parameter table</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt_2cols</span>
        <span class="n">fmt</span><span class="p">[</span><span class="s1">&#39;data_fmts&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%18s</span><span class="s1">&#39;</span>

        <span class="n">top_right</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;</span><span class="si">%-21s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">top_right</span><span class="p">]</span>
        <span class="n">stubs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stub</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">top_right</span><span class="p">:</span>
            <span class="n">stubs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stub</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">val</span><span class="p">])</span>
        <span class="n">table</span><span class="o">.</span><span class="n">extend_right</span><span class="p">(</span><span class="n">SimpleTable</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">stubs</span><span class="o">=</span><span class="n">stubs</span><span class="p">))</span>
        <span class="n">smry</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="n">conf_int</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conf_int</span><span class="p">())</span>
        <span class="n">conf_int_str</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conf_int</span><span class="p">:</span>
            <span class="n">conf_int_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">format_float_fixed</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">format_float_fixed</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>

        <span class="n">stubs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">,</span> <span class="s1">&#39;std err&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;P&gt;|t|&#39;</span><span class="p">,</span> <span class="s1">&#39;95.0% Conf. Int.&#39;</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">std_err</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tvalues</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pvalues</span><span class="p">,</span>
                <span class="n">conf_int_str</span><span class="p">)</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">param_table_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">):</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="n">format_float_fixed</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="o">*</span><span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">converted</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
                <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">converted</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">param_table_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="n">mc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">(</span><span class="n">mc</span><span class="p">,</span> <span class="n">vc</span><span class="p">,</span> <span class="n">dc</span><span class="p">)</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Mean Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Volatility Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Distribution&#39;</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">counts</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">table_data</span> <span class="o">=</span> <span class="n">param_table_data</span><span class="p">[</span><span class="n">total</span><span class="p">:</span><span class="n">total</span> <span class="o">+</span> <span class="n">count</span><span class="p">]</span>
            <span class="n">table_stubs</span> <span class="o">=</span> <span class="n">stubs</span><span class="p">[</span><span class="n">total</span><span class="p">:</span><span class="n">total</span> <span class="o">+</span> <span class="n">count</span><span class="p">]</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">count</span>
            <span class="n">table</span> <span class="o">=</span> <span class="n">SimpleTable</span><span class="p">(</span><span class="n">table_data</span><span class="p">,</span>
                                <span class="n">stubs</span><span class="o">=</span><span class="n">table_stubs</span><span class="p">,</span>
                                <span class="n">txt_fmt</span><span class="o">=</span><span class="n">fmt_params</span><span class="p">,</span>
                                <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
            <span class="n">smry</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="n">extra_text</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Covariance estimator: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">convergence_flag</span><span class="p">:</span>
            <span class="n">extra_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">WARNING: The optimizer did not indicate successful convergence. The message was</span>
<span class="si">{string_message}</span><span class="s2">. See convergence_flag.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">string_message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_optim_output</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>

        <span class="n">smry</span><span class="o">.</span><span class="n">add_extra_txt</span><span class="p">(</span><span class="n">extra_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">smry</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">param_cov</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parameter covariance&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_cov</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_cov</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov_type</span> <span class="o">==</span> <span class="s1">&#39;robust&#39;</span><span class="p">:</span>
                <span class="n">param_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">compute_param_cov</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">param_cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">compute_param_cov</span><span class="p">(</span><span class="n">params</span><span class="p">,</span>
                                                         <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">param_cov</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">rsquared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        R-squared</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">fit_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">fit_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">rsquared_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Degree of freedom adjusted R-squared</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rsquared</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">num_params</span><span class="p">))</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">pvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Array of p-values for the t-statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tvalues</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                         <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;pvalues&#39;</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">std_err</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Array of parameter standard errors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_cov</span><span class="p">)),</span>
                         <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;std_err&#39;</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">tvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Array of t-statistics testing the null that the coefficient are 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_err</span>
        <span class="n">tvalues</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;tvalues&#39;</span>
        <span class="k">return</span> <span class="n">tvalues</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">convergence_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        scipy.optimize.minimize result flag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optim_output</span><span class="o">.</span><span class="n">status</span></div>


<span class="k">def</span> <span class="nf">_align_forecast</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">align</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">align</span> <span class="o">==</span> <span class="s1">&#39;origin&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="s1">&#39;horizon&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">f</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown alignment&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_format_forecasts</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">horizon</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">format_str</span> <span class="o">=</span> <span class="s1">&#39;{0:&gt;0&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">horizon</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))))</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;h.&#39;</span> <span class="o">+</span> <span class="n">format_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon</span><span class="p">)]</span>
    <span class="n">forecasts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                             <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">forecasts</span>


<div class="viewcode-block" id="ARCHModelForecastSimulation"><a class="viewcode-back" href="../../../univariate/forecasting.html#arch.univariate.base.ARCHModelForecastSimulation">[docs]</a><span class="k">class</span> <span class="nc">ARCHModelForecastSimulation</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container for a simulation or bootstrap-based forecasts from an ARCH Model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    values</span>
<span class="sd">    residuals</span>
<span class="sd">    variances</span>
<span class="sd">    residual_variances</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    values : DataFrame</span>
<span class="sd">        Simulated values of the process</span>
<span class="sd">    residuals : DataFrame</span>
<span class="sd">        Simulated residuals used to produce the values</span>
<span class="sd">    variances : DataFrame</span>
<span class="sd">        Simulated variances of the values</span>
<span class="sd">    residual_variances : DataFrame</span>
<span class="sd">        Simulated variance of the residuals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">variances</span><span class="p">,</span> <span class="n">residual_variances</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_residuals</span> <span class="o">=</span> <span class="n">residuals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variances</span> <span class="o">=</span> <span class="n">variances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_residual_variances</span> <span class="o">=</span> <span class="n">residual_variances</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_residuals</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variances</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">residual_variances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_residual_variances</span></div>


<div class="viewcode-block" id="ARCHModelForecast"><a class="viewcode-back" href="../../../univariate/forecasting.html#arch.univariate.base.ARCHModelForecast">[docs]</a><span class="k">class</span> <span class="nc">ARCHModelForecast</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Container for forecasts from an ARCH Model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index : {list, ndarray}</span>
<span class="sd">    mean : ndarray</span>
<span class="sd">    variance : ndarray</span>
<span class="sd">    residual_variance : ndarray</span>
<span class="sd">    simulated_paths : ndarray, optional</span>
<span class="sd">    simulated_variances : ndarray, optional</span>
<span class="sd">    simulated_residual_variances : ndarray, optional</span>
<span class="sd">    simulated_residuals : ndarray, optional</span>
<span class="sd">    align : {&#39;origin&#39;, &#39;target&#39;}</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    mean : DataFrame</span>
<span class="sd">        Forecast values for the conditional mean of the process</span>
<span class="sd">    variance : DataFrame</span>
<span class="sd">        Forecast values for the conditional variance of the process</span>
<span class="sd">    residual_variance : DataFrame</span>
<span class="sd">        Forecast values for the conditional variance of the residuals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">residual_variance</span><span class="p">,</span>
                 <span class="n">simulated_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">simulated_variances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">simulated_residual_variances</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">simulated_residuals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">align</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">):</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">_format_forecasts</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">_format_forecasts</span><span class="p">(</span><span class="n">variance</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="n">residual_variance</span> <span class="o">=</span> <span class="n">_format_forecasts</span><span class="p">(</span><span class="n">residual_variance</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="n">_align_forecast</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_variance</span> <span class="o">=</span> <span class="n">_align_forecast</span><span class="p">(</span><span class="n">variance</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_residual_variance</span> <span class="o">=</span> <span class="n">_align_forecast</span><span class="p">(</span><span class="n">residual_variance</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span> <span class="o">=</span> <span class="n">ARCHModelForecastSimulation</span><span class="p">(</span><span class="n">simulated_paths</span><span class="p">,</span>
                                                <span class="n">simulated_residuals</span><span class="p">,</span>
                                                <span class="n">simulated_variances</span><span class="p">,</span>
                                                <span class="n">simulated_residual_variances</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">residual_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_residual_variance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detailed simulation results if using a simulation-based method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sim</span></div>
</pre></div>

          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">arch 4.7.0+4.g8a3c5ff documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Kevin Sheppard. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>