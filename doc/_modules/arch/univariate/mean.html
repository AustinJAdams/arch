

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>arch.univariate.mean &#8212; arch 4.7.0+2.g146c488 documentation</title>
    <link rel="stylesheet" href="../../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  
  
   

  <link rel="stylesheet" href="../../../_static/css/overrides.css" type="text/css" />

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">arch 4.7.0+2.g146c488 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    ../../../index.html" class="text-logo">arch 4.7.0 (+2)</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../univariate/univariate.html">Univariate Volatility Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bootstrap/bootstrap.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../multiple-comparison/multiple-comparisons.html">Multiple Comparison Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../unitroot/unitroot.html">Unit Root Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">Change Log</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../../index.html">Docs</a></li>
              
                <li><a href="../../index.html">Module code</a></li>
              
              <li>arch.univariate.mean</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <h1>Source code for arch.univariate.mean</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Mean models to use with ARCH processes.  All mean models must inherit from</span>
<span class="sd">:class:`ARCHModel` and provide the same methods with the same inputs.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">arch.compat.python</span> <span class="k">import</span> <span class="n">iteritems</span><span class="p">,</span> <span class="nb">range</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="k">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">OptimizeResult</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.tsatools</span> <span class="k">import</span> <span class="n">lagmat</span>

<span class="kn">from</span> <span class="nn">arch.univariate.base</span> <span class="k">import</span> <span class="p">(</span><span class="n">ARCHModel</span><span class="p">,</span> <span class="n">ARCHModelForecast</span><span class="p">,</span>
                                  <span class="n">ARCHModelResult</span><span class="p">,</span> <span class="n">implicit_constant</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">arch.univariate.distribution</span> <span class="k">import</span> <span class="p">(</span><span class="n">GeneralizedError</span><span class="p">,</span> <span class="n">Normal</span><span class="p">,</span>
                                          <span class="n">SkewStudent</span><span class="p">,</span> <span class="n">StudentsT</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">arch.univariate.volatility</span> <span class="k">import</span> <span class="p">(</span><span class="n">ARCH</span><span class="p">,</span> <span class="n">EGARCH</span><span class="p">,</span> <span class="n">FIGARCH</span><span class="p">,</span> <span class="n">GARCH</span><span class="p">,</span> <span class="n">HARCH</span><span class="p">,</span>
                                        <span class="n">ConstantVariance</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">arch.utility.array</span> <span class="k">import</span> <span class="n">cutoff_to_index</span><span class="p">,</span> <span class="n">ensure1d</span><span class="p">,</span> <span class="n">parse_dataframe</span>
<span class="kn">from</span> <span class="nn">arch.vendor.cached_property</span> <span class="k">import</span> <span class="n">cached_property</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HARX&#39;</span><span class="p">,</span> <span class="s1">&#39;ConstantMean&#39;</span><span class="p">,</span> <span class="s1">&#39;ZeroMean&#39;</span><span class="p">,</span> <span class="s1">&#39;ARX&#39;</span><span class="p">,</span> <span class="s1">&#39;arch_model&#39;</span><span class="p">,</span> <span class="s1">&#39;LS&#39;</span><span class="p">]</span>

<span class="n">COV_TYPES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;white&#39;</span><span class="p">:</span> <span class="s1">&#39;White</span><span class="se">\&#39;</span><span class="s1">s Heteroskedasticity Consistent Estimator&#39;</span><span class="p">,</span>
             <span class="s1">&#39;classic_ols&#39;</span><span class="p">:</span> <span class="s1">&#39;Homoskedastic (Classic)&#39;</span><span class="p">,</span>
             <span class="s1">&#39;robust&#39;</span><span class="p">:</span> <span class="s1">&#39;Bollerslev-Wooldridge (Robust) Estimator&#39;</span><span class="p">,</span>
             <span class="s1">&#39;mle&#39;</span><span class="p">:</span> <span class="s1">&#39;ML Estimator&#39;</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">_forecast_pad</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">forecasts</span><span class="p">):</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">forecasts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
    <span class="n">fill</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fill</span><span class="p">,</span> <span class="n">forecasts</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_ar_forecast</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">arp</span><span class="p">,</span> <span class="n">exogp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate mean forecasts from an AR-X model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : ndarray</span>
<span class="sd">    horizon : int</span>
<span class="sd">    start_index : int</span>
<span class="sd">    constant : float</span>
<span class="sd">    arp : ndarray</span>
<span class="sd">    exogp : ndarray</span>
<span class="sd">    x : ndarray</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    forecasts : ndarray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">arp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">fcasts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="n">horizon</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">fcasts</span><span class="p">[</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="o">-</span><span class="n">p</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">horizon</span> <span class="o">+</span> <span class="n">p</span><span class="p">):</span>
        <span class="n">fcasts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">constant</span> <span class="o">+</span> <span class="n">fcasts</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="n">p</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">arp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fcasts</span><span class="p">[:</span><span class="n">start_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">fcasts</span> <span class="o">=</span> <span class="n">fcasts</span><span class="p">[:,</span> <span class="n">p</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">exog_comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">exogp</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span>
        <span class="n">fcasts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">exog_comp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">fcasts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">fcasts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">fcasts</span>


<span class="k">def</span> <span class="nf">_ar_to_impulse</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">impulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
    <span class="n">impulse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">impulse</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">impulse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">impulse</span><span class="p">[</span><span class="n">st</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">impulse</span>


<div class="viewcode-block" id="HARX"><a class="viewcode-back" href="../../../univariate/mean.html#arch.HARX">[docs]</a><span class="k">class</span> <span class="nc">HARX</span><span class="p">(</span><span class="n">ARCHModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Heterogeneous Autoregression (HAR), with optional exogenous regressors,</span>
<span class="sd">    model estimation and simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : {ndarray, Series}</span>
<span class="sd">        nobs element vector containing the dependent variable</span>
<span class="sd">    x : {ndarray, DataFrame}, optional</span>
<span class="sd">        nobs by k element array containing exogenous regressors</span>
<span class="sd">    lags : {scalar, ndarray}, optional</span>
<span class="sd">        Description of lag structure of the HAR.  Scalar included all lags</span>
<span class="sd">        between 1 and the value.  A 1-d array includes the HAR lags 1:lags[0],</span>
<span class="sd">        1:lags[1], ... A 2-d array includes the HAR lags of the form</span>
<span class="sd">        lags[0,j]:lags[1,j] for all columns of lags.</span>
<span class="sd">    constant : bool, optional</span>
<span class="sd">        Flag whether the model should include a constant</span>
<span class="sd">    use_rotated : bool, optional</span>
<span class="sd">        Flag indicating to use the alternative rotated form of the HAR where</span>
<span class="sd">        HAR lags do not overlap</span>
<span class="sd">    hold_back : int</span>
<span class="sd">        Number of observations at the start of the sample to exclude when</span>
<span class="sd">        estimating model parameters.  Used when comparing models with different</span>
<span class="sd">        lag lengths to estimate on the common sample.</span>
<span class="sd">    volatility : VolatilityProcess, optional</span>
<span class="sd">        Volatility process to use in the model</span>
<span class="sd">    distribution : Distribution, optional</span>
<span class="sd">        Error distribution to use in the model</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from arch.univariate import HARX</span>
<span class="sd">    &gt;&gt;&gt; y = np.random.randn(100)</span>
<span class="sd">    &gt;&gt;&gt; harx = HARX(y, lags=[1, 5, 22])</span>
<span class="sd">    &gt;&gt;&gt; res = harx.fit()</span>

<span class="sd">    &gt;&gt;&gt; from pandas import Series, date_range</span>
<span class="sd">    &gt;&gt;&gt; index = date_range(&#39;2000-01-01&#39;, freq=&#39;M&#39;, periods=y.shape[0])</span>
<span class="sd">    &gt;&gt;&gt; y = Series(y, name=&#39;y&#39;, index=index)</span>
<span class="sd">    &gt;&gt;&gt; har = HARX(y, lags=[1, 6], hold_back=10)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The HAR-X model is described by</span>

<span class="sd">    .. math::</span>

<span class="sd">        y_t = \mu + \sum_{i=1}^p \phi_{L_{i}} \bar{y}_{t-L_{i,0}:L_{i,1}}</span>
<span class="sd">        + \gamma&#39; x_t + \epsilon_t</span>

<span class="sd">    where :math:`\bar{y}_{t-L_{i,0}:L_{i,1}}` is the average value of</span>
<span class="sd">    :math:`y_t` between :math:`t-L_{i,0}` and :math:`t - L_{i,1}`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">use_rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HARX</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">,</span>
                                   <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
                                   <span class="n">distribution</span><span class="o">=</span><span class="n">distribution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="o">=</span> <span class="n">constant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_rotated</span> <span class="o">=</span> <span class="n">use_rotated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regressors</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;HAR&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;-X&#39;</span>
        <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_lags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_lags</span> <span class="o">=</span> <span class="n">max_lags</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hold_back</span> <span class="o">=</span> <span class="n">max_lags</span> <span class="k">if</span> <span class="n">hold_back</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">hold_back</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hold_back</span> <span class="o">&lt;</span> <span class="n">max_lags</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;hold_back is less then the minimum number given the lags &#39;</span>
                 <span class="s1">&#39;selected&#39;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hold_back</span> <span class="o">=</span> <span class="n">max_lags</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_model</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the value of the exogenous regressors in the model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>

    <span class="k">def</span> <span class="nf">parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_variable_names</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_static_gaussian_loglikelihood</span><span class="p">(</span><span class="n">resids</span><span class="p">):</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="n">resids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">resids</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>

        <span class="n">loglikelihood</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">nobs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">loglikelihood</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">nobs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span>
        <span class="n">loglikelihood</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">nobs</span>

        <span class="k">return</span> <span class="n">loglikelihood</span>

    <span class="k">def</span> <span class="nf">_model_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_lags</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the model description for use by __str__ and related</span>
<span class="sd">        functions&quot;&quot;&quot;</span>
        <span class="n">lagstr</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">if</span> <span class="n">include_lags</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lagstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
                      <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
            <span class="n">lagstr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lagstr</span><span class="p">)</span>
        <span class="n">xstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;0&#39;</span>
        <span class="n">conststr</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="k">else</span> <span class="s1">&#39;no&#39;</span>
        <span class="n">od</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;constant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conststr</span>
        <span class="k">if</span> <span class="n">include_lags</span><span class="p">:</span>
            <span class="n">od</span><span class="p">[</span><span class="s1">&#39;lags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lagstr</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;no. of exog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xstr</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">od</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">descr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_description</span><span class="p">()</span>
        <span class="n">descr_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">descr</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">descr_str</span> <span class="o">+=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span>
        <span class="n">descr_str</span> <span class="o">=</span> <span class="n">descr_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Strip final &#39;, &#39;</span>
        <span class="n">descr_str</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>

        <span class="k">return</span> <span class="n">descr_str</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">txt</span> <span class="o">+</span> <span class="s1">&#39;, id: &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;HTML representation for IPython Notebook&quot;&quot;&quot;</span>
        <span class="n">descr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_description</span><span class="p">()</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;strong&gt;&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;&lt;/strong&gt;(&#39;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">descr</span><span class="p">):</span>
            <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;strong&gt;&#39;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;: &lt;/strong&gt;&#39;</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s1">&#39;,</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;strong&gt;ID: &lt;/strong&gt; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">html</span>

<div class="viewcode-block" id="HARX.resids"><a class="viewcode-back" href="../../../univariate/mean.html#arch.HARX.resids">[docs]</a>    <span class="k">def</span> <span class="nf">resids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regressors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">regressors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_regressors</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">regressors</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">y</span>

        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">regressors</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regressors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<div class="viewcode-block" id="HARX.simulate"><a class="viewcode-back" href="../../../univariate/mean.html#arch.HARX.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">initial_value_vol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulates data from a linear regression, AR or HAR models</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            Parameters to use when simulating the model.  Parameter order is</span>
<span class="sd">            [mean volatility distribution] where the parameters of the mean</span>
<span class="sd">            model are ordered [constant lag[0] lag[1] ... lag[p] ex[0] ...</span>
<span class="sd">            ex[k-1]] where lag[j] indicates the coefficient on the jth lag in</span>
<span class="sd">            the model and ex[j] is the coefficient on the jth exogenous</span>
<span class="sd">            variable.</span>
<span class="sd">        nobs : int</span>
<span class="sd">            Length of series to simulate</span>
<span class="sd">        burn : int, optional</span>
<span class="sd">            Number of values to simulate to initialize the model and remove</span>
<span class="sd">            dependence on initial values.</span>
<span class="sd">        initial_value : {ndarray, float}, optional</span>
<span class="sd">            Either a scalar value or `max(lags)` array set of initial values to</span>
<span class="sd">            use when initializing the model.  If omitted, 0.0 is used.</span>
<span class="sd">        x : {ndarray, DataFrame}, optional</span>
<span class="sd">            nobs + burn by k array of exogenous variables to include in the</span>
<span class="sd">            simulation.</span>
<span class="sd">        initial_value_vol : {ndarray, float}, optional</span>
<span class="sd">            An array or scalar to use when initializing the volatility process.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        simulated_data : DataFrame</span>
<span class="sd">            DataFrame with columns data containing the simulated values,</span>
<span class="sd">            volatility, containing the conditional volatility and errors</span>
<span class="sd">            containing the errors used in the simulation</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from arch.univariate import HARX, GARCH</span>
<span class="sd">        &gt;&gt;&gt; harx = HARX(lags=[1, 5, 22])</span>
<span class="sd">        &gt;&gt;&gt; harx.volatility = GARCH()</span>
<span class="sd">        &gt;&gt;&gt; harx_params = np.array([1, 0.2, 0.3, 0.4])</span>
<span class="sd">        &gt;&gt;&gt; garch_params = np.array([0.01, 0.07, 0.92])</span>
<span class="sd">        &gt;&gt;&gt; params = np.concatenate((harx_params, garch_params))</span>
<span class="sd">        &gt;&gt;&gt; sim_data = harx.simulate(params, 1000)</span>

<span class="sd">        Simulating models with exogenous regressors requires the regressors</span>
<span class="sd">        to have nobs plus burn data points</span>

<span class="sd">        &gt;&gt;&gt; nobs = 100</span>
<span class="sd">        &gt;&gt;&gt; burn = 200</span>
<span class="sd">        &gt;&gt;&gt; x = np.random.randn(nobs + burn, 2)</span>
<span class="sd">        &gt;&gt;&gt; x_params = np.array([1.0, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; params = np.concatenate((harx_params, x_params, garch_params))</span>
<span class="sd">        &gt;&gt;&gt; sim_data = harx.simulate(params, nobs=nobs, burn=burn, x=x)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">k_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">k_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nobs</span> <span class="o">+</span> <span class="n">burn</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x must have nobs + burn rows&#39;</span><span class="p">)</span>

        <span class="n">mc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">k_x</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">num_params</span>
        <span class="n">num_params</span> <span class="o">=</span> <span class="n">mc</span> <span class="o">+</span> <span class="n">vc</span> <span class="o">+</span> <span class="n">dc</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">ensure1d</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="n">series</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">num_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;params has the wrong number of elements. &#39;</span>
                             <span class="s1">&#39;Expected &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_params</span><span class="p">)</span> <span class="o">+</span>
                             <span class="s1">&#39;, got &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="n">dist_params</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">dc</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="n">dc</span><span class="p">:]</span>
        <span class="n">vol_params</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">mc</span><span class="p">:</span><span class="n">mc</span> <span class="o">+</span> <span class="n">vc</span><span class="p">]</span>
        <span class="n">simulator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">dist_params</span><span class="p">)</span>
        <span class="n">sim_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">vol_params</span><span class="p">,</span>
                                            <span class="n">nobs</span> <span class="o">+</span> <span class="n">burn</span><span class="p">,</span>
                                            <span class="n">simulator</span><span class="p">,</span>
                                            <span class="n">burn</span><span class="p">,</span>
                                            <span class="n">initial_value_vol</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">sim_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sim_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">max_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nobs</span> <span class="o">+</span> <span class="n">burn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">initial_value</span><span class="p">):</span>
            <span class="n">initial_value</span> <span class="o">=</span> <span class="n">ensure1d</span><span class="p">(</span><span class="n">initial_value</span><span class="p">,</span> <span class="s1">&#39;initial_value&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">initial_value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">max_lag</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;initial_value has the wrong shape&#39;</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[:</span><span class="n">max_lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_value</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lag</span><span class="p">,</span> <span class="n">nobs</span> <span class="o">+</span> <span class="n">burn</span><span class="p">):</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
                <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">params</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="n">lag</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">t</span> <span class="o">-</span> <span class="n">lag</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k_x</span><span class="p">):</span>
                <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">params</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">errors</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">burn</span><span class="p">:],</span> <span class="n">volatility</span><span class="o">=</span><span class="n">vol</span><span class="p">[</span><span class="n">burn</span><span class="p">:],</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">[</span><span class="n">burn</span><span class="p">:])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

    <span class="k">def</span> <span class="nf">_generate_variable_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates variable names or use in summaries&quot;&quot;&quot;</span>
        <span class="n">variable_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Const&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_lag_names</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variable_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">variable_names</span>

    <span class="k">def</span> <span class="nf">_generate_lag_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates lag names.  Overridden by other models&quot;&quot;&quot;</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span> <span class="o">+</span> <span class="n">var_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">var_name</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lags</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lags</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span> <span class="nf">_check_specification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks the specification for obvious errors &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;x must be nobs by n, where nobs is the same as &#39;</span>
                    <span class="s1">&#39;the number of elements in y&#39;</span><span class="p">)</span>
            <span class="n">def_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_index</span> <span class="o">=</span> <span class="n">parse_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="n">def_names</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reformat_lags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reformat input lags to be a 2 by m array, which simplifies other</span>
<span class="sd">        operations.  Output is stored in _lags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span>
        <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lags</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input to lags must be non-negative&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lags</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lags</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lags</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When using the 1-d format of lags, values &#39;</span>
                                 <span class="s1">&#39;must be positive&#39;</span><span class="p">)</span>
            <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lags</span><span class="p">,</span> <span class="n">lags</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_rotated</span><span class="p">:</span>
                <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="k">elif</span> <span class="n">lags</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;When using a 2-d array, lags must by k by 2&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lags</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect values in lags&#39;</span><span class="p">)</span>

            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">lags</span><span class="p">))</span>
            <span class="n">lags</span> <span class="o">=</span> <span class="n">lags</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
            <span class="n">test_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lags</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">test_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">lags</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]:</span><span class="n">lags</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">matrix_rank</span><span class="p">(</span><span class="n">test_mat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rank</span> <span class="o">!=</span> <span class="n">lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lags contains redundant entries&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span> <span class="o">=</span> <span class="n">lags</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_rotated</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

                <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Rotation is not available when using the &#39;</span>
                     <span class="s1">&#39;2-d lags input format&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect format for lags&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_har_to_ar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_lags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span>
        <span class="n">har</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">):]</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_lags</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">har</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
            <span class="n">ar</span><span class="p">[</span><span class="n">lag</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">lag</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">value</span> <span class="o">/</span> <span class="p">(</span><span class="n">lag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">params</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">ar</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ar</span>

    <span class="k">def</span> <span class="nf">_init_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Should be called whenever the model is initialized or changed&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reformat_lags</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_specification</span><span class="p">()</span>

        <span class="n">nobs_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">:</span>
            <span class="n">reg_constant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nobs_orig</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_constant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nobs_orig</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nobs_orig</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">maxlag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lags</span><span class="p">)</span>
            <span class="n">lag_array</span> <span class="o">=</span> <span class="n">lagmat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">maxlag</span><span class="p">)</span>
            <span class="n">reg_lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nobs_orig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">lags</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">reg_lags</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lag_array</span><span class="p">[:,</span> <span class="n">lags</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">lags</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nobs_orig</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reg_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reg_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nobs_orig</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regressors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">reg_constant</span><span class="p">,</span> <span class="n">reg_lags</span><span class="p">,</span> <span class="n">reg_x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_r2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_regressors</span>
        <span class="n">constant</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">constant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="ow">or</span> <span class="n">implicit_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">constant</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">e</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_adjust_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="o">.</span><span class="n">index</span>
        <span class="n">_first_obs_index</span> <span class="o">=</span> <span class="n">cutoff_to_index</span><span class="p">(</span><span class="n">first_obs</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">_first_obs_index</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hold_back</span>
        <span class="n">_last_obs_index</span> <span class="o">=</span> <span class="n">cutoff_to_index</span><span class="p">(</span><span class="n">last_obs</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">_last_obs_index</span> <span class="o">&lt;=</span> <span class="n">_first_obs_index</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;first_obs and last_obs produce in an &#39;</span>
                             <span class="s1">&#39;empty array.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">_first_obs_index</span><span class="p">,</span> <span class="n">_last_obs_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">[</span><span class="n">_first_obs_index</span><span class="p">:</span><span class="n">_last_obs_index</span><span class="p">]</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fit_regressors</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="n">_first_obs_index</span><span class="p">:</span><span class="n">_last_obs_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>

    <span class="k">def</span> <span class="nf">_fit_no_arch_normal_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;robust&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimates model parameters</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cov_type : str, optional</span>
<span class="sd">            Covariance estimator to use when estimating parameter variances and</span>
<span class="sd">            covariances.  One of &#39;hetero&#39; or &#39;heteroskedastic&#39; for Whites&#39;s</span>
<span class="sd">            covariance estimator, or &#39;mle&#39; for the classic</span>
<span class="sd">            OLS estimator appropriate for homoskedastic data.  &#39;hetero&#39; is the</span>
<span class="sd">            the default.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : ARCHModelResult</span>
<span class="sd">            Results class containing parameter estimates, estimated parameter</span>
<span class="sd">            covariance and related estimates</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        See :class:`ARCHModelResult` for details on computed results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">nobs</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Insufficient data, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; regressors, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">nobs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; data points available&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_regressors</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span>

        <span class="c1"># Fake convergence results, see GH #87</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">OptimizeResult</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">regression_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">xpxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span><span class="p">)</span>
            <span class="n">fitted</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">regression_params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regression_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">xpxi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">fitted</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">e</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">fitted</span>
        <span class="n">sigma2</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">regression_params</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">))</span>
        <span class="n">hessian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">hessian</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">xpxi</span>
        <span class="n">hessian</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">cov_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;mle&#39;</span><span class="p">,):</span>
            <span class="n">param_cov</span> <span class="o">=</span> <span class="n">sigma2</span> <span class="o">*</span> <span class="o">-</span><span class="n">hessian</span>
            <span class="n">param_cov</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sigma2</span> <span class="o">**</span> <span class="mf">2.0</span>
            <span class="n">param_cov</span> <span class="o">/=</span> <span class="n">nobs</span>
            <span class="n">cov_type</span> <span class="o">=</span> <span class="n">COV_TYPES</span><span class="p">[</span><span class="s1">&#39;classic_ols&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cov_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;robust&#39;</span><span class="p">,):</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nobs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_params</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">scores</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">num_params</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">e</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
            <span class="n">scores</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span> <span class="o">**</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">sigma2</span>
            <span class="n">score_cov</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>
            <span class="n">param_cov</span> <span class="o">=</span> <span class="n">hessian</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">score_cov</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hessian</span><span class="p">)</span> <span class="o">/</span> <span class="n">nobs</span>
            <span class="n">cov_type</span> <span class="o">=</span> <span class="n">COV_TYPES</span><span class="p">[</span><span class="s1">&#39;white&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown cov_type&#39;</span><span class="p">)</span>

        <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r2</span><span class="p">(</span><span class="n">regression_params</span><span class="p">)</span>

        <span class="n">first_obs</span><span class="p">,</span> <span class="n">last_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">resids</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">resids</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="n">vol</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">vol</span><span class="p">[</span><span class="n">first_obs</span><span class="p">:</span><span class="n">last_obs</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_parameter_names</span><span class="p">()</span>
        <span class="n">loglikelihood</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static_gaussian_loglikelihood</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c1"># Throw away names in the case of starting values</span>
        <span class="n">num_params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="n">num_params</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_params</span><span class="p">)]</span>

        <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="k">return</span> <span class="n">ARCHModelResult</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param_cov</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">resids</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">cov_type</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">loglikelihood</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_is_pandas</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fit_start</span><span class="p">,</span> <span class="n">fit_stop</span><span class="p">,</span>
                               <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

<div class="viewcode-block" id="HARX.forecast"><a class="viewcode-back" href="../../../univariate/mean.html#arch.HARX.forecast">[docs]</a>    <span class="k">def</span> <span class="nf">forecast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;origin&#39;</span><span class="p">,</span>
                 <span class="n">method</span><span class="o">=</span><span class="s1">&#39;analytic&#39;</span><span class="p">,</span> <span class="n">simulations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Check start</span>
        <span class="n">earliest</span><span class="p">,</span> <span class="n">default_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_indices</span>
        <span class="n">default_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">default_start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="n">cutoff_to_index</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">default_start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_index</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">earliest</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Due to backcasting and/or data availability start cannot be less &#39;</span>
                             <span class="s1">&#39;than the index of the largest value in the right-hand-side &#39;</span>
                             <span class="s1">&#39;variables used to fit the first observation.  In this model, &#39;</span>
                             <span class="s1">&#39;this value is </span><span class="si">{0}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">earliest</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="c1"># Parse params</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">mp</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="c1">#####################################</span>
        <span class="c1"># Compute residual variance forecasts</span>
        <span class="c1">#####################################</span>
        <span class="c1"># Back cast should use only the sample used in fitting</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
        <span class="n">backcast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span><span class="o">.</span><span class="n">backcast</span><span class="p">(</span><span class="n">resids</span><span class="p">)</span>
        <span class="n">full_resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resids</span><span class="p">(</span><span class="n">mp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">[</span><span class="n">earliest</span><span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">regressors</span><span class="p">[</span><span class="n">earliest</span><span class="p">:])</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span><span class="o">.</span><span class="n">variance_bounds</span><span class="p">(</span><span class="n">full_resids</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distribution</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
        <span class="n">variance_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_index</span> <span class="o">-</span> <span class="n">earliest</span><span class="p">)</span>
        <span class="n">vfcast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_volatility</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="n">full_resids</span><span class="p">,</span> <span class="n">backcast</span><span class="p">,</span> <span class="n">vb</span><span class="p">,</span>
                                           <span class="n">start</span><span class="o">=</span><span class="n">variance_start</span><span class="p">,</span>
                                           <span class="n">horizon</span><span class="o">=</span><span class="n">horizon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                           <span class="n">simulations</span><span class="o">=</span><span class="n">simulations</span><span class="p">,</span> <span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">var_fcasts</span> <span class="o">=</span> <span class="n">vfcast</span><span class="o">.</span><span class="n">forecasts</span>
        <span class="n">var_fcasts</span> <span class="o">=</span> <span class="n">_forecast_pad</span><span class="p">(</span><span class="n">earliest</span><span class="p">,</span> <span class="n">var_fcasts</span><span class="p">)</span>

        <span class="n">arp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_har_to_ar</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
        <span class="n">nexog</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">exog_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mp</span><span class="p">[</span><span class="o">-</span><span class="n">nexog</span><span class="p">:]</span>
        <span class="n">constant</span> <span class="o">=</span> <span class="n">arp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">dynp</span> <span class="o">=</span> <span class="n">arp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constant</span><span class="p">):]</span>
        <span class="n">mean_fcast</span> <span class="o">=</span> <span class="n">_ar_forecast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">horizon</span><span class="p">,</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">dynp</span><span class="p">,</span> <span class="n">exog_p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>
        <span class="c1"># Compute total variance forecasts, which depend on model</span>
        <span class="n">impulse</span> <span class="o">=</span> <span class="n">_ar_to_impulse</span><span class="p">(</span><span class="n">horizon</span><span class="p">,</span> <span class="n">dynp</span><span class="p">)</span>
        <span class="n">longrun_var_fcasts</span> <span class="o">=</span> <span class="n">var_fcasts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon</span><span class="p">):</span>
            <span class="n">lrf</span> <span class="o">=</span> <span class="n">var_fcasts</span><span class="p">[:,</span> <span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">impulse</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">longrun_var_fcasts</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lrf</span>

        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;simulation&#39;</span><span class="p">,</span> <span class="s1">&#39;bootstrap&#39;</span><span class="p">):</span>
            <span class="c1"># TODO: This is not tested, but probably right</span>
            <span class="n">variance_paths</span> <span class="o">=</span> <span class="n">_forecast_pad</span><span class="p">(</span><span class="n">earliest</span><span class="p">,</span> <span class="n">vfcast</span><span class="o">.</span><span class="n">forecast_paths</span><span class="p">)</span>
            <span class="n">long_run_variance_paths</span> <span class="o">=</span> <span class="n">variance_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">shocks</span> <span class="o">=</span> <span class="n">_forecast_pad</span><span class="p">(</span><span class="n">earliest</span><span class="p">,</span> <span class="n">vfcast</span><span class="o">.</span><span class="n">shocks</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon</span><span class="p">):</span>
                <span class="n">_impulses</span> <span class="o">=</span> <span class="n">impulse</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span> <span class="kc">None</span><span class="p">]</span>
                <span class="n">lrvp</span> <span class="o">=</span> <span class="n">variance_paths</span><span class="p">[</span><span class="n">start_index</span><span class="p">:,</span> <span class="p">:,</span> <span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">_impulses</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">long_run_variance_paths</span><span class="p">[</span><span class="n">start_index</span><span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">lrvp</span><span class="p">)</span>
            <span class="n">t</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_lags</span>
            <span class="n">mean_paths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">simulations</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="n">horizon</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">dynp_rev</span> <span class="o">=</span> <span class="n">dynp</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_index</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
                <span class="n">mean_paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">horizon</span><span class="p">):</span>
                    <span class="n">mean_paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">m</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">constant</span> <span class="o">+</span> \
                                              <span class="n">mean_paths</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">:</span><span class="n">m</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dynp_rev</span><span class="p">)</span> <span class="o">+</span> \
                                              <span class="n">shocks</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">mean_paths</span> <span class="o">=</span> <span class="n">mean_paths</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">m</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variance_paths</span> <span class="o">=</span> <span class="n">mean_paths</span> <span class="o">=</span> <span class="n">shocks</span> <span class="o">=</span> <span class="n">long_run_variance_paths</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="n">ARCHModelForecast</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">mean_fcast</span><span class="p">,</span> <span class="n">longrun_var_fcasts</span><span class="p">,</span>
                                 <span class="n">var_fcasts</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="n">align</span><span class="p">,</span>
                                 <span class="n">simulated_paths</span><span class="o">=</span><span class="n">mean_paths</span><span class="p">,</span>
                                 <span class="n">simulated_residuals</span><span class="o">=</span><span class="n">shocks</span><span class="p">,</span>
                                 <span class="n">simulated_variances</span><span class="o">=</span><span class="n">long_run_variance_paths</span><span class="p">,</span>
                                 <span class="n">simulated_residual_variances</span><span class="o">=</span><span class="n">variance_paths</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ConstantMean"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ConstantMean">[docs]</a><span class="k">class</span> <span class="nc">ConstantMean</span><span class="p">(</span><span class="n">HARX</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constant mean model estimation and simulation.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : {ndarray, Series}</span>
<span class="sd">        nobs element vector containing the dependent variable</span>
<span class="sd">    hold_back : int</span>
<span class="sd">        Number of observations at the start of the sample to exclude when</span>
<span class="sd">        estimating model parameters.  Used when comparing models with different</span>
<span class="sd">        lag lengths to estimate on the common sample.</span>
<span class="sd">    volatility : VolatilityProcess, optional</span>
<span class="sd">        Volatility process to use in the model</span>
<span class="sd">    distribution : Distribution, optional</span>
<span class="sd">        Error distribution to use in the model</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from arch.univariate import ConstantMean</span>
<span class="sd">    &gt;&gt;&gt; y = np.random.randn(100)</span>
<span class="sd">    &gt;&gt;&gt; cm = ConstantMean(y)</span>
<span class="sd">    &gt;&gt;&gt; res = cm.fit()</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The constant mean model is described by</span>

<span class="sd">    .. math::</span>

<span class="sd">        y_t = \mu + \epsilon_t</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">volatility</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ConstantMean</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">,</span>
                                           <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
                                           <span class="n">distribution</span><span class="o">=</span><span class="n">distribution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Constant Mean&#39;</span>

    <span class="k">def</span> <span class="nf">parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;mu&#39;</span><span class="p">]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_model_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_lags</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ConstantMean</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_model_description</span><span class="p">(</span><span class="n">include_lags</span><span class="p">)</span>

<div class="viewcode-block" id="ConstantMean.simulate"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ConstantMean.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_value_vol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulated data from a constant mean model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : ndarray</span>
<span class="sd">            Parameters to use when simulating the model.  Parameter order is</span>
<span class="sd">            [mean volatility distribution]. There is one parameter in the mean</span>
<span class="sd">            model, mu.</span>
<span class="sd">        nobs : int</span>
<span class="sd">            Length of series to simulate</span>
<span class="sd">        burn : int, optional</span>
<span class="sd">            Number of values to simulate to initialize the model and remove</span>
<span class="sd">            dependence on initial values.</span>
<span class="sd">        initial_value : None</span>
<span class="sd">            This value is not used.</span>
<span class="sd">        x : None</span>
<span class="sd">            This value is not used.</span>
<span class="sd">        initial_value_vol : {ndarray, float}, optional</span>
<span class="sd">            An array or scalar to use when initializing the volatility process.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        simulated_data : DataFrame</span>
<span class="sd">            DataFrame with columns data containing the simulated values,</span>
<span class="sd">            volatility, containing the conditional volatility and errors</span>
<span class="sd">            containing the errors used in the simulation</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Basic data simulation with a constant mean and volatility</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from arch.univariate import ConstantMean, GARCH</span>
<span class="sd">        &gt;&gt;&gt; cm = ConstantMean()</span>
<span class="sd">        &gt;&gt;&gt; cm.volatility = GARCH()</span>
<span class="sd">        &gt;&gt;&gt; cm_params = np.array([1])</span>
<span class="sd">        &gt;&gt;&gt; garch_params = np.array([0.01, 0.07, 0.92])</span>
<span class="sd">        &gt;&gt;&gt; params = np.concatenate((cm_params, garch_params))</span>
<span class="sd">        &gt;&gt;&gt; sim_data = cm.simulate(params, 1000)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Both initial value and x must be none when &#39;</span>
                             <span class="s1">&#39;simulating a constant mean process.&#39;</span><span class="p">)</span>

        <span class="n">mp</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">sim_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span>
                                              <span class="n">nobs</span> <span class="o">+</span> <span class="n">burn</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span>
                                              <span class="n">burn</span><span class="p">,</span>
                                              <span class="n">initial_value_vol</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">sim_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">errors</span> <span class="o">+</span> <span class="n">mp</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sim_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">burn</span><span class="p">:],</span> <span class="n">volatility</span><span class="o">=</span><span class="n">vol</span><span class="p">[</span><span class="n">burn</span><span class="p">:],</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">[</span><span class="n">burn</span><span class="p">:])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="ConstantMean.resids"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ConstantMean.resids">[docs]</a>    <span class="k">def</span> <span class="nf">resids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regressors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">y</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="n">params</span></div></div>


<div class="viewcode-block" id="ZeroMean"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ZeroMean">[docs]</a><span class="k">class</span> <span class="nc">ZeroMean</span><span class="p">(</span><span class="n">HARX</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model with zero conditional mean estimation and simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : {ndarray, Series}</span>
<span class="sd">        nobs element vector containing the dependent variable</span>
<span class="sd">    hold_back : int</span>
<span class="sd">        Number of observations at the start of the sample to exclude when</span>
<span class="sd">        estimating model parameters.  Used when comparing models with different</span>
<span class="sd">        lag lengths to estimate on the common sample.</span>
<span class="sd">    volatility : VolatilityProcess, optional</span>
<span class="sd">        Volatility process to use in the model</span>
<span class="sd">    distribution : Distribution, optional</span>
<span class="sd">        Error distribution to use in the model</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from arch.univariate import ZeroMean</span>
<span class="sd">    &gt;&gt;&gt; y = np.random.randn(100)</span>
<span class="sd">    &gt;&gt;&gt; zm = ZeroMean(y)</span>
<span class="sd">    &gt;&gt;&gt; res = zm.fit()</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The zero mean model is described by</span>

<span class="sd">    .. math::</span>

<span class="sd">        y_t = \epsilon_t</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">volatility</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ZeroMean</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span>
                                       <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                       <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">,</span>
                                       <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
                                       <span class="n">distribution</span><span class="o">=</span><span class="n">distribution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Zero Mean&#39;</span>

    <span class="k">def</span> <span class="nf">parameter_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">num_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_model_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_lags</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ZeroMean</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_model_description</span><span class="p">(</span><span class="n">include_lags</span><span class="p">)</span>

<div class="viewcode-block" id="ZeroMean.simulate"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ZeroMean.simulate">[docs]</a>    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">burn</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">initial_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">initial_value_vol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simulated data from a zero mean model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params : {ndarray, DataFrame}</span>
<span class="sd">            Parameters to use when simulating the model.  Parameter order is</span>
<span class="sd">            [volatility distribution]. There are no mean parameters.</span>
<span class="sd">        nobs : int</span>
<span class="sd">            Length of series to simulate</span>
<span class="sd">        burn : int, optional</span>
<span class="sd">            Number of values to simulate to initialize the model and remove</span>
<span class="sd">            dependence on initial values.</span>
<span class="sd">        initial_value : None</span>
<span class="sd">            This value is not used.</span>
<span class="sd">        x : None</span>
<span class="sd">            This value is not used.</span>
<span class="sd">        initial_value_vol : {ndarray, float}, optional</span>
<span class="sd">            An array or scalar to use when initializing the volatility process.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        simulated_data : DataFrame</span>
<span class="sd">            DataFrame with columns data containing the simulated values,</span>
<span class="sd">            volatility, containing the conditional volatility and errors</span>
<span class="sd">            containing the errors used in the simulation</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Basic data simulation with no mean and constant volatility</span>

<span class="sd">        &gt;&gt;&gt; from arch.univariate import ZeroMean</span>
<span class="sd">        &gt;&gt;&gt; zm = ZeroMean()</span>
<span class="sd">        &gt;&gt;&gt; sim_data = zm.simulate([1.0], 1000)</span>

<span class="sd">        Simulating data with a non-trivial volatility process</span>

<span class="sd">        &gt;&gt;&gt; from arch.univariate import GARCH</span>
<span class="sd">        &gt;&gt;&gt; zm.volatility = GARCH(p=1, o=1, q=1)</span>
<span class="sd">        &gt;&gt;&gt; sim_data = zm.simulate([0.05, 0.1, 0.1, 0.8], 300)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">initial_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Both initial value and x must be none when &#39;</span>
                             <span class="s1">&#39;simulating a constant mean process.&#39;</span><span class="p">)</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_parameters</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

        <span class="n">sim_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span>
                                              <span class="n">nobs</span> <span class="o">+</span> <span class="n">burn</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span>
                                              <span class="n">burn</span><span class="p">,</span>
                                              <span class="n">initial_value_vol</span><span class="p">)</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">sim_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">errors</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sim_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">burn</span><span class="p">:],</span> <span class="n">volatility</span><span class="o">=</span><span class="n">vol</span><span class="p">[</span><span class="n">burn</span><span class="p">:],</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">[</span><span class="n">burn</span><span class="p">:])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="ZeroMean.resids"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ZeroMean.resids">[docs]</a>    <span class="k">def</span> <span class="nf">resids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">regressors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_y</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">y</span></div></div>


<div class="viewcode-block" id="ARX"><a class="viewcode-back" href="../../../univariate/mean.html#arch.ARX">[docs]</a><span class="k">class</span> <span class="nc">ARX</span><span class="p">(</span><span class="n">HARX</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Autoregressive model with optional exogenous regressors estimation and</span>
<span class="sd">    simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : {ndarray, Series}</span>
<span class="sd">        nobs element vector containing the dependent variable</span>
<span class="sd">    x : {ndarray, DataFrame}, optional</span>
<span class="sd">        nobs by k element array containing exogenous regressors</span>
<span class="sd">    lags : scalar, 1-d array, optional</span>
<span class="sd">        Description of lag structure of the HAR.  Scalar included all lags</span>
<span class="sd">        between 1 and the value.  A 1-d array includes the AR lags lags[0],</span>
<span class="sd">        lags[1], ...</span>
<span class="sd">    constant : bool, optional</span>
<span class="sd">        Flag whether the model should include a constant</span>
<span class="sd">    hold_back : int</span>
<span class="sd">        Number of observations at the start of the sample to exclude when</span>
<span class="sd">        estimating model parameters.  Used when comparing models with different</span>
<span class="sd">        lag lengths to estimate on the common sample.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from arch.univariate import ARX</span>
<span class="sd">    &gt;&gt;&gt; y = np.random.randn(100)</span>
<span class="sd">    &gt;&gt;&gt; arx = ARX(y, lags=[1, 5, 22])</span>
<span class="sd">    &gt;&gt;&gt; res = arx.fit()</span>

<span class="sd">    Estimating an AR with GARCH(1,1) errors</span>
<span class="sd">    &gt;&gt;&gt; from arch.univariate import GARCH</span>
<span class="sd">    &gt;&gt;&gt; arx.volatility = GARCH()</span>
<span class="sd">    &gt;&gt;&gt; res = arx.fit(update_freq=0, disp=&#39;off&#39;)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The AR-X model is described by</span>

<span class="sd">    .. math::</span>

<span class="sd">        y_t = \mu + \sum_{i=1}^p \phi_{L_{i}} y_{t-L_{i}} + \gamma&#39; x_t</span>
<span class="sd">        + \epsilon_t</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Convert lags to 2-d format</span>

        <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lags</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lags</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lags must be a positive integer.&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">lags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">lags</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lags</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">lags</span><span class="p">,</span> <span class="n">lags</span><span class="p">))</span>
                    <span class="n">lags</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;lags does not follow a supported format&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ARX</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                  <span class="n">hold_back</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="n">volatility</span><span class="p">,</span>
                                  <span class="n">distribution</span><span class="o">=</span><span class="n">distribution</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;AR&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="s1">&#39;-X&#39;</span>

    <span class="k">def</span> <span class="nf">_model_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_lags</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generates the model description for use by __str__ and related</span>
<span class="sd">        functions&quot;&quot;&quot;</span>
        <span class="n">lagstr</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
        <span class="k">if</span> <span class="n">include_lags</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lagstr</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">lag</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
            <span class="n">lagstr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lagstr</span><span class="p">)</span>

        <span class="n">xstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s1">&#39;0&#39;</span>
        <span class="n">conststr</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constant</span> <span class="k">else</span> <span class="s1">&#39;no&#39;</span>
        <span class="n">od</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;constant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conststr</span>
        <span class="k">if</span> <span class="n">include_lags</span><span class="p">:</span>
            <span class="n">od</span><span class="p">[</span><span class="s1">&#39;lags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lagstr</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;no. of exog&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xstr</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;volatility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">volatility</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="n">od</span><span class="p">[</span><span class="s1">&#39;distribution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">od</span>

    <span class="k">def</span> <span class="nf">_generate_lag_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lags</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y_series</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span> <span class="o">+</span> <span class="n">var_name</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var_name</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lags</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span></div>


<div class="viewcode-block" id="LS"><a class="viewcode-back" href="../../../univariate/mean.html#arch.LS">[docs]</a><span class="k">class</span> <span class="nc">LS</span><span class="p">(</span><span class="n">HARX</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Least squares model estimation and simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : {ndarray, Series}</span>
<span class="sd">        nobs element vector containing the dependent variable</span>
<span class="sd">    y : {ndarray, DataFrame}, optional</span>
<span class="sd">        nobs by k element array containing exogenous regressors</span>
<span class="sd">    constant : bool, optional</span>
<span class="sd">        Flag whether the model should include a constant</span>
<span class="sd">    hold_back : int</span>
<span class="sd">        Number of observations at the start of the sample to exclude when</span>
<span class="sd">        estimating model parameters.  Used when comparing models with different</span>
<span class="sd">        lag lengths to estimate on the common sample.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from arch.univariate import LS</span>
<span class="sd">    &gt;&gt;&gt; y = np.random.randn(100)</span>
<span class="sd">    &gt;&gt;&gt; x = np.random.randn(100,2)</span>
<span class="sd">    &gt;&gt;&gt; ls = LS(y, x)</span>
<span class="sd">    &gt;&gt;&gt; res = ls.fit()</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The LS model is described by</span>

<span class="sd">    .. math::</span>

<span class="sd">        y_t = \mu + \gamma&#39; x_t + \epsilon_t</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Convert lags to 2-d format</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">LS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">hold_back</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Least Squares&#39;</span>

    <span class="k">def</span> <span class="nf">_model_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_lags</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">LS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_model_description</span><span class="p">(</span><span class="n">include_lags</span><span class="p">)</span></div>


<div class="viewcode-block" id="arch_model"><a class="viewcode-back" href="../../../univariate/introduction.html#arch.arch_model">[docs]</a><span class="k">def</span> <span class="nf">arch_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="s1">&#39;Constant&#39;</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vol</span><span class="o">=</span><span class="s1">&#39;Garch&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">power</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience function to simplify initialization of ARCH models</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : {ndarray, Series, None}</span>
<span class="sd">        The dependent variable</span>
<span class="sd">    x : {np.array, DataFrame}, optional</span>
<span class="sd">        Exogenous regressors.  Ignored if model does not permit exogenous</span>
<span class="sd">        regressors.</span>
<span class="sd">    mean : str, optional</span>
<span class="sd">        Name of the mean model.  Currently supported options are: &#39;Constant&#39;,</span>
<span class="sd">        &#39;Zero&#39;, &#39;ARX&#39; and  &#39;HARX&#39;</span>
<span class="sd">    lags : int or list (int), optional</span>
<span class="sd">        Either a scalar integer value indicating lag length or a list of</span>
<span class="sd">        integers specifying lag locations.</span>
<span class="sd">    vol : str, optional</span>
<span class="sd">        Name of the volatility model.  Currently supported options are:</span>
<span class="sd">        &#39;GARCH&#39; (default), &#39;ARCH&#39;, &#39;EGARCH&#39;, &#39;FIARCH&#39; and &#39;HARCH&#39;</span>
<span class="sd">    p : int, optional</span>
<span class="sd">        Lag order of the symmetric innovation</span>
<span class="sd">    o : int, optional</span>
<span class="sd">        Lag order of the asymmetric innovation</span>
<span class="sd">    q : int, optional</span>
<span class="sd">        Lag order of lagged volatility or equivalent</span>
<span class="sd">    power : float, optional</span>
<span class="sd">        Power to use with GARCH and related models</span>
<span class="sd">    dist : int, optional</span>
<span class="sd">        Name of the error distribution.  Currently supported options are:</span>

<span class="sd">            * Normal: &#39;normal&#39;, &#39;gaussian&#39; (default)</span>
<span class="sd">            * Students&#39;s t: &#39;t&#39;, &#39;studentst&#39;</span>
<span class="sd">            * Skewed Student&#39;s t: &#39;skewstudent&#39;, &#39;skewt&#39;</span>
<span class="sd">            * Generalized Error Distribution: &#39;ged&#39;, &#39;generalized error&quot;</span>

<span class="sd">    hold_back : int</span>
<span class="sd">        Number of observations at the start of the sample to exclude when</span>
<span class="sd">        estimating model parameters.  Used when comparing models with different</span>
<span class="sd">        lag lengths to estimate on the common sample.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    model : ARCHModel</span>
<span class="sd">        Configured ARCH model</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import datetime as dt</span>
<span class="sd">    &gt;&gt;&gt; import pandas_datareader.data as web</span>
<span class="sd">    &gt;&gt;&gt; djia = web.get_data_fred(&#39;DJIA&#39;)</span>
<span class="sd">    &gt;&gt;&gt; returns = 100 * djia[&#39;DJIA&#39;].pct_change().dropna()</span>

<span class="sd">    A basic GARCH(1,1) with a constant mean can be constructed using only</span>
<span class="sd">    the return data</span>

<span class="sd">    &gt;&gt;&gt; from arch.univariate import arch_model</span>
<span class="sd">    &gt;&gt;&gt; am = arch_model(returns)</span>

<span class="sd">    Alternative mean and volatility processes can be directly specified</span>

<span class="sd">    &gt;&gt;&gt; am = arch_model(returns, mean=&#39;AR&#39;, lags=2, vol=&#39;harch&#39;, p=[1, 5, 22])</span>

<span class="sd">    This example demonstrates the construction of a zero mean process</span>
<span class="sd">    with a TARCH volatility process and Student t error distribution</span>

<span class="sd">    &gt;&gt;&gt; am = arch_model(returns, mean=&#39;zero&#39;, p=1, o=1, q=1,</span>
<span class="sd">    ...                 power=1.0, dist=&#39;StudentsT&#39;)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Input that are not relevant for a particular specification, such as `lags`</span>
<span class="sd">    when `mean=&#39;zero&#39;`, are silently ignored.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">known_mean</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;zero&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;harx&#39;</span><span class="p">,</span> <span class="s1">&#39;har&#39;</span><span class="p">,</span> <span class="s1">&#39;ar&#39;</span><span class="p">,</span> <span class="s1">&#39;arx&#39;</span><span class="p">,</span> <span class="s1">&#39;ls&#39;</span><span class="p">)</span>
    <span class="n">known_vol</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;arch&#39;</span><span class="p">,</span> <span class="s1">&#39;figarch&#39;</span><span class="p">,</span> <span class="s1">&#39;garch&#39;</span><span class="p">,</span> <span class="s1">&#39;harch&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;egarch&#39;</span><span class="p">)</span>
    <span class="n">known_dist</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;studentst&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;skewstudent&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;skewt&#39;</span><span class="p">,</span> <span class="s1">&#39;ged&#39;</span><span class="p">,</span> <span class="s1">&#39;generalized error&#39;</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">mean</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">known_mean</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown model type in mean&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">vol</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">known_vol</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown model type in vol&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dist</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">known_dist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown model type in dist&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mean</span> <span class="o">==</span> <span class="s1">&#39;zero&#39;</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">ZeroMean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">ConstantMean</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="s1">&#39;harx&#39;</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">HARX</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="s1">&#39;har&#39;</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">HARX</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="s1">&#39;arx&#39;</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">ARX</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mean</span> <span class="o">==</span> <span class="s1">&#39;ar&#39;</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">ARX</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lags</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">am</span> <span class="o">=</span> <span class="n">LS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">hold_back</span><span class="o">=</span><span class="n">hold_back</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">vol</span> <span class="o">==</span> <span class="s1">&#39;constant&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ConstantVariance</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">vol</span> <span class="o">==</span> <span class="s1">&#39;arch&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">ARCH</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">vol</span> <span class="o">==</span> <span class="s1">&#39;figarch&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">FIGARCH</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">vol</span> <span class="o">==</span> <span class="s1">&#39;garch&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">GARCH</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">o</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="n">power</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">vol</span> <span class="o">==</span> <span class="s1">&#39;egarch&#39;</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">EGARCH</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">o</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># vol == &#39;harch&#39;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">HARCH</span><span class="p">(</span><span class="n">lags</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dist</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;skewstudent&#39;</span><span class="p">,</span> <span class="s1">&#39;skewt&#39;</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">SkewStudent</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">dist</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;studentst&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">StudentsT</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">dist</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ged&#39;</span><span class="p">,</span> <span class="s1">&#39;generalized error&#39;</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">GeneralizedError</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># (&#39;gaussian&#39;, &#39;normal&#39;)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">()</span>

    <span class="n">am</span><span class="o">.</span><span class="n">volatility</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">am</span><span class="o">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">return</span> <span class="n">am</span></div>
</pre></div>

          </div>
            
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">arch 4.7.0+2.g146c488 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2018, Kevin Sheppard. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>